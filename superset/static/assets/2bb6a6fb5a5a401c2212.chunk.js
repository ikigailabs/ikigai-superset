"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[576],{58642:(t,e,o)=>{o.d(e,{fE:()=>s,nn:()=>c,pU:()=>i,pn:()=>l,zF:()=>u}),o(96540);var n=o(34005),a=o(17437);const r=new n.FilterXSS({whiteList:{...(0,n.getDefaultWhiteList)(),span:["style","class","title"],div:["style","class"],a:["style","class","href","title","target"],img:["style","class","src","alt","title","width","height"],video:["autoplay","controls","loop","preload","src","height","width","muted"]},stripIgnoreTag:!0,css:!1});function l(t){return r.process(t)}function s(t){return Array.from((new DOMParser).parseFromString(t,"text/html").body.childNodes).some((({nodeType:t})=>1===t))}function i(t){return s(t)?l(t):t}function c(t){return s(t)?(0,a.Y)("span",{className:"safe-html-wrapper",dangerouslySetInnerHTML:{__html:l(t)}}):t}function u(t){return t.replace(/<[^>]*>/g,"")}},70957:(t,e,o)=>{o.d(e,{S:()=>g});var n=o(2404),a=o.n(n),r=o(96540),l=o(92094),s=o(45722),i=o(83505),c=o(90017),u=o(58642),p=o(17437);const d=c.A.div`
  ${({theme:t,top:e,left:o})=>`\n    position: absolute;\n    top: ${e}px;\n    left: ${o}px;\n    padding: ${2*t.gridUnit}px;\n    margin: ${2*t.gridUnit}px;\n    background: ${t.colors.grayscale.dark2};\n    color: ${t.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${t.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}
`;function f(t){const{tooltip:e}=t;if(null==e)return null;const{x:o,y:n,content:a}=e,r="string"==typeof a?(0,u.nn)(a):a;return(0,p.Y)(d,{top:n,left:o},r)}const h=(0,r.memo)((0,r.forwardRef)(((t,e)=>{const[o,n]=(0,r.useState)(null),[c,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(t.viewport),g=(0,i.Z)(t.viewport);(0,r.useImperativeHandle)(e,(()=>({setTooltip:n})),[]);const m=(0,r.useCallback)((()=>{if(c&&Date.now()-c>250){const e=t.setControlValue;e&&e("viewport",d),u(null)}}),[c,t.setControlValue,d]);(0,r.useEffect)((()=>{const t=setInterval(m,250);return clearInterval(t)}),[m]),(0,r.useEffect)((()=>{a()(t.viewport,g)||h(t.viewport)}),[g,t.viewport]);const y=(0,r.useCallback)((({viewState:t})=>{h(t),u(Date.now())}),[]),b=(0,r.useCallback)((()=>t.layers.some((t=>"function"==typeof t))?t.layers.map((t=>"function"==typeof t?t():t)):t.layers),[t.layers]),{children:w=null,height:v,width:x}=t;return(0,p.Y)(r.Fragment,null,(0,p.Y)("div",{style:{position:"relative",width:x,height:v}},(0,p.Y)(s.A,{controller:!0,width:x,height:v,layers:b(),viewState:d,glOptions:{preserveDrawingBuffer:!0},onViewStateChange:y},(0,p.Y)(l.b,{preserveDrawingBuffer:!0,mapStyle:t.mapStyle||"light",mapboxApiAccessToken:t.mapboxApiAccessToken})),w),(0,p.Y)(f,{tooltip:o}))}))),g=(0,c.A)(h)`
  .deckgl-tooltip > div {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`},32548:(t,e,o)=>{o.d(e,{A:()=>a}),o(96540);var n=o(17437);const a=({label:t,value:e})=>(0,n.Y)("div",null,t,(0,n.Y)("strong",null,e))},66671:(t,e,o)=>{o.d(e,{A:()=>u});var n=o(96540),a=o(90017),r=o(32142),l=o(17437);const s=a.A.div`
  ${({theme:t})=>`\n    font-size: ${t.typography.sizes.s}px;\n    position: absolute;\n    background: ${t.colors.grayscale.light5};\n    box-shadow: 0 0 ${t.gridUnit}px ${t.colors.grayscale.light2};\n    margin: ${6*t.gridUnit}px;\n    padding: ${3*t.gridUnit}px ${5*t.gridUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        color: ${t.colors.grayscale.base};\n        text-decoration: none;\n\n        & span {\n          margin-right: ${3*t.gridUnit}px;\n        }\n      }\n    }\n  `}
`,i=" - ",c=({format:t=null,forceCategorical:e=!1,position:o="tr",categories:n={},toggleCategory:a=(()=>{}),showSingleCategory:c=(()=>{})})=>{const u=o=>{if(!t||e)return o;const n=parseFloat(o);return(0,r.ZV)(t,n)};if(0===Object.keys(n).length||null===o)return null;const p=Object.entries(n).map((([e,o])=>{const n={color:`rgba(${o.color.join(", ")})`},r=o.enabled?"◼":"◻";return(0,l.Y)("li",{key:e},(0,l.Y)("a",{href:"#",onClick:()=>a(e),onDoubleClick:()=>c(e)},(0,l.Y)("span",{style:n},r)," ",(e=>{if(!t)return e;if(e.includes(i)){const t=e.split(i);return u(t[0])+i+u(t[1])}return u(e)})(e)))})),d={position:"absolute",["t"===(null==o?void 0:o.charAt(0))?"top":"bottom"]:"0px",["r"===(null==o?void 0:o.charAt(1))?"right":"left"]:"10px"};return(0,l.Y)(s,{className:"dupa",style:d},(0,l.Y)("ul",null,p))},u=(0,n.memo)(c)},47823:(t,e,o)=>{o.d(e,{c:()=>w,y:()=>b});var n=o(2404),a=o.n(n),r=o(96540),l=o(83505),s=o(70957),i=o(94963),c=o(66671),u=o(49443),p=o(25564),d=o(95490),f=o(17437);const{getScale:h}=i;function g(t,e){const o=t.color_picker||{r:0,g:0,b:0,a:1},n=[o.r,o.g,o.b,255*o.a],a=h(t.color_scheme),r={};return e.forEach((e=>{if(null!=e.cat_color&&!r.hasOwnProperty(e.cat_color)){let l;l=t.dimension?(0,u.hexToRGB)(a(e.cat_color,t.sliceId),255*o.a):n,r[e.cat_color]={color:l,enabled:!0}}})),r}const m=t=>{const e=(0,r.useRef)(null),o=(0,r.useCallback)((()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,d.A)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e}),[t]),[n,a]=(0,r.useState)(g(t.formData,t.payload.data.features||[])),[l,i]=(0,r.useState)(t.payload.form_data),[m,y]=(0,r.useState)(o());(0,r.useEffect)((()=>{if(t.payload.form_data!==l){const e=t.payload.data.features||[],n=g(t.formData,e);y(o()),i(t.payload.form_data),a(n)}}),[o,t,l]);const b=(0,r.useCallback)((t=>{const{current:o}=e;o&&o.setTooltip(t)}),[]),w=(0,r.useCallback)(((t,e)=>{const o=e.color_picker||{r:0,g:0,b:0,a:1},n=h(e.color_scheme);return t.map((t=>{let a;return e.dimension?(a=(0,u.hexToRGB)(n(t.cat_color,e.sliceId),255*o.a),{...t,color:a}):t}))}),[]),v=(0,r.useCallback)((()=>{const{getLayer:e,payload:o,formData:a,onAddFilter:r}=t;let l=o.data.features?[...o.data.features]:[];return l=w(l,a),a.js_data_mutator&&(l=(0,p.A)(a.js_data_mutator)(l)),a.dimension&&(l=l.filter((t=>{var e;return null==(e=n[t.cat_color])?void 0:e.enabled}))),[e(a,{...o,data:{...o.data,features:l}},r,b,t.datasource)]}),[w,n,t,b]),x=(0,r.useCallback)((t=>{const e=n[t],o={...n,[t]:{...e,enabled:!e.enabled}};Object.values(o).every((t=>!t.enabled))&&Object.values(o).forEach((t=>{t.enabled=!0})),a(o)}),[n]),k=(0,r.useCallback)((t=>{const e={...n};Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,a(e)}),[n]);return(0,f.Y)("div",{style:{position:"relative"}},(0,f.Y)(s.S,{ref:e,viewport:m,layers:v(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,f.Y)(c.A,{forceCategorical:!0,categories:n,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:k,toggleCategory:x}))},y=(0,r.memo)(m);function b(t,e){return(0,r.memo)((o=>{const n=(0,r.useRef)(),i=(0,l.Z)(o.formData),c=(0,l.Z)(o.payload),[u,p]=(0,r.useState)((()=>{const{width:t,height:n,formData:a}=o;return a.autozoom?(0,d.A)(o.viewport,{width:t,height:n,points:e(o.payload.data.features)}):o.viewport})()),h=(0,r.useCallback)((t=>{const{current:e}=n;e&&(null==e||e.setTooltip(t))}),[]),g=(0,r.useCallback)((e=>{const{formData:o,payload:n,onAddFilter:a}=e;return t(o,n,a,h)}),[h]),[m,y]=(0,r.useState)(g(o));(0,r.useEffect)((()=>{const t={...i,viewport:null},e={...o.formData,viewport:null};a()(t,e)&&c===o.payload||y(g(o))}),[g,i,c,o]);const{formData:b,payload:w,setControlValue:v,height:x,width:k}=o;return(0,f.Y)(s.S,{ref:n,mapboxApiAccessToken:w.data.mapboxApiKey,viewport:u,layers:[m],mapStyle:b.mapbox_style,setControlValue:v,width:k,height:x,onViewportChange:p})}))}function w(t,e){return function(o){const{datasource:n,formData:a,height:r,payload:l,setControlValue:s,viewport:i,width:c}=o;return(0,f.Y)(y,{datasource:n,formData:a,mapboxApiKey:l.data.mapboxApiKey,setControlValue:s,viewport:i,getLayer:t,payload:l,getPoints:e,width:c,height:r})}}},41857:(t,e,o)=>{o.d(e,{T:()=>r,g:()=>s});var n=o(86914),a=o(25564);function r(t,e,o,n){const r=t;let l,s,i=o;return r.js_tooltip&&(i=(0,a.A)(r.js_tooltip)),i&&(l=t=>(t.picked?e({content:i(t),x:t.x,y:t.y}):e(null),!0)),r.js_onclick_href?s=t=>{const e=(0,a.A)(r.js_onclick_href)(t);return window.open(e),!0}:r.table_filter&&void 0!==n&&(s=t=>(n(t.object[r.line_column]),!0)),{onClick:s,onHover:l,pickable:Boolean(l)}}const l={p1:.01,p5:.05,p95:.95,p99:.99};function s(t="sum",e=null){if("count"===t)return t=>t.length;let o;return o=t in l?(o,a)=>{let r;return r=e?o.sort(((t,o)=>n.ascending(e(t),e(o)))):o.sort(n.ascending),n.quantile(r,l[t],a)}:n[t],e?t=>o(t.map((t=>e(t)))):t=>o(t)}},49443:(t,e,o)=>{o.r(e),o.d(e,{hexToRGB:()=>a});var n=o(2117);function a(t,e=255){if(!t)return[0,0,0,e];const{r:o,g:a,b:r}=(0,n.Qh)(t);return[o,a,r,e]}},95490:(t,e,o)=>{o.d(e,{A:()=>i});var n=o(54982),a=o(86914);const r=[-90,90],l=[-180,180];function s([t,e],[o,n],a=.25){return t<e?[t,e]:[Math.max(o,t-a),Math.min(n,e+a)]}function i(t,{points:e,width:o,height:i,minExtent:c,maxZoom:u,offset:p,padding:d=20}){const{bearing:f,pitch:h}=t,g=function(t){const e=s((0,a.extent)(t,(t=>t[1])),r),o=s((0,a.extent)(t,(t=>t[0])),l);return[[o[0],e[0]],[o[1],e[1]]]}(e);try{return{...(0,n.Fe)({bounds:g,width:o,height:i,minExtent:c,maxZoom:u,offset:p,padding:d}),bearing:f,pitch:h}}catch(t){console.error("Could not fit viewport",t)}return t}},25564:(t,e,o)=>{o.d(e,{A:()=>c});var n=o(68961),a=o.n(n),r=o(4523),l=o(86914),s=o(49443);const i={console,_:r.Ay,colors:s,d3array:l};function c(t,e,o){const n={},r=`SAFE_EVAL_${Math.floor(1e6*Math.random())}`;n[r]={};const l=`${r}=${t}`,s={...i,...e};Object.keys(s).forEach((t=>{n[t]=s[t]}));try{return a().runInNewContext(l,n,o),n[r]}catch(t){return()=>t}}}}]);
//# sourceMappingURL=2bb6a6fb5a5a401c2212.chunk.js.map