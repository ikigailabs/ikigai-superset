"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3608],{33608:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h,extractTreePathInfo:()=>i});var n=r(96540),l=r(7349),a=r(32142),s=r(86444),c=r(85867),u=r(71194),o=r(17437);const i=e=>(null!=e?e:[]).map((e=>(null==e?void 0:e.name)||"")).filter((e=>""!==e));function h(e){const{height:t,width:r,echartOptions:h,setDataMask:d,labelMap:f,selectedValues:p,formData:g,onContextMenu:m,refs:v,emitCrossFilters:b,coltypeMapping:w}=e,{columns:k}=g,y=(0,n.useCallback)((e=>{const t=i(e),r=t.join(","),n=Object.values(p);let l;l=n.includes(r)?n.filter((e=>e!==r)):[r];const a=l.map((e=>f[e]));return{dataMask:{extraFormData:{filters:0!==l.length&&k?k.slice(0,t.length).map(((e,t)=>{const r=a.map((e=>e[t]));return null==r?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:r}})):[]},filterState:{value:a.length?a:null,selectedValues:l.length?l:null}},isCurrentValueSelected:n.includes(r)}}),[k,f,p]),I=(0,n.useCallback)((e=>{b&&d(y(e).dataMask)}),[b,d,y]),E={click:e=>{const{treePathInfo:t}=e;I(t)},contextmenu:async e=>{if(m){e.event.stop();const{data:t,treePathInfo:r}=e,{records:n}=t,c=i(e.treePathInfo),o=e.event.event,h=[],d=[];if(null!=k&&k.length){c.forEach(((e,t)=>h.push({col:k[t],op:"==",val:n[t],formattedVal:e})));const e=c[c.length-1];d.push({col:k[c.length-1],op:"==",val:e,formattedVal:(0,u.Wy)(e,{timeFormatter:(0,l.mo)(g.dateFormat),numberFormatter:(0,a.gV)(g.numberFormat),coltype:null==w?void 0:w[(0,s.A)(k[c.length-1])]})})}m(o.clientX,o.clientY,{drillToDetail:h,crossFilter:y(r),drillBy:{filters:d,groupbyFieldName:"columns"}})}}};return(0,o.Y)(c.A,{refs:v,height:t,width:r,echartOptions:h,eventHandlers:E,selectedValues:p})}},85867:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(96540),l=r(90017),a=r(49805),s=r(17437);const c=l.A.div`
  height: ${({height:e})=>e};
  width: ${({width:e})=>e};
`;function u({width:e,height:t,echartOptions:r,eventHandlers:l,zrEventHandlers:u,selectedValues:o={},refs:i},h){const d=(0,n.useRef)(null);i&&(i.divRef=d);const f=(0,n.useRef)(),p=(0,n.useMemo)((()=>Object.keys(o)||[]),[o]),g=(0,n.useRef)([]);(0,n.useImperativeHandle)(h,(()=>({getEchartInstance:()=>f.current}))),(0,n.useEffect)((()=>{d.current&&(f.current||(f.current=(0,a.Ts)(d.current)),Object.entries(l||{}).forEach((([e,t])=>{var r,n;null==(r=f.current)||r.off(e),null==(n=f.current)||n.on(e,t)})),Object.entries(u||{}).forEach((([e,t])=>{var r,n;null==(r=f.current)||r.getZr().off(e),null==(n=f.current)||n.getZr().on(e,t)})),f.current.setOption(r,!0))}),[r,l,u]),(0,n.useEffect)((()=>{f.current&&(f.current.dispatchAction({type:"downplay",dataIndex:g.current.filter((e=>!p.includes(e)))}),p.length&&f.current.dispatchAction({type:"highlight",dataIndex:p}),g.current=p)}),[p]);const m=(0,n.useCallback)((({width:e,height:t})=>{f.current&&f.current.resize({width:e,height:t})}),[]);return(0,n.useEffect)((()=>(m({width:e,height:t}),()=>{var e;return null==(e=f.current)?void 0:e.dispose()})),[]),(0,n.useLayoutEffect)((()=>{m({width:e,height:t})}),[e,t,m]),(0,s.Y)(c,{ref:d,height:t,width:e})}const o=(0,n.forwardRef)(u)}}]);
//# sourceMappingURL=4ef1c45bd043fe610a25.chunk.js.map