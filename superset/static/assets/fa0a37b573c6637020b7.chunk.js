"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[2629],{82629:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J,getLayer:()=>$});var i=n(96540),o=n(95579),a=n(64467),l=n(97418),r=n(93261),s=n(98537),u=n(46101),c=n(36976),d=n(41595),g=n(67823);const h=[0,0,0,255],p={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:h},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class f extends l.A{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&r.A.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const t=this.state.paths.slice(),n=e.dataChanged.map((e=>(0,g.J)({data:t,getIndex:e=>e.__source.index,dataRange:e,replace:this._getPaths(e)})));this.setState({paths:t,pathsDiff:n})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:n,positionFormat:i,_normalize:o}=this.props,a=[],l="XY"===i?2:3,{startRow:r,endRow:u}=e,{iterable:c,objectInfo:g}=(0,s.X)(t,r,u);for(const e of c){g.index++;let t=n(e,g);o&&(t=d.S8(t,l));const{holeIndices:i}=t,r=t.positions||t;if(i)for(let t=0;t<=i.length;t++){const n=r.slice(i[t-1]||0,i[t]||r.length);a.push(this.getSubLayerRow({path:n},e,g.index))}else a.push(this.getSubLayerRow({path:r},e,g.index))}return a}renderLayers(){const{data:e,_dataDiff:t,stroked:n,filled:i,extruded:o,wireframe:a,_normalize:l,_windingOrder:r,elevationScale:s,transitions:d,positionFormat:g}=this.props,{lineWidthUnits:p,lineWidthScale:f,lineWidthMinPixels:m,lineWidthMaxPixels:y,lineJointRounded:_,lineMiterLimit:b,lineDashJustified:v}=this.props,{getFillColor:A,getLineColor:C,getLineWidth:L,getLineDashArray:x,getElevation:w,getPolygon:S,updateTriggers:k,material:F}=this.props,{paths:P,pathsDiff:D}=this.state,W=this.getSubLayerClass("fill",u.A),M=this.getSubLayerClass("stroke",c.A),T=this.shouldRenderSubLayer("fill",P)&&new W({_dataDiff:t,extruded:o,elevationScale:s,filled:i,wireframe:a,_normalize:l,_windingOrder:r,getElevation:w,getFillColor:A,getLineColor:o&&a?C:h,material:F,transitions:d},this.getSubLayerProps({id:"fill",updateTriggers:k&&{getPolygon:k.getPolygon,getElevation:k.getElevation,getFillColor:k.getFillColor,lineColors:o&&a,getLineColor:k.getLineColor}}),{data:e,positionFormat:g,getPolygon:S});return[!o&&T,!o&&n&&this.shouldRenderSubLayer("stroke",P)&&new M({_dataDiff:D&&(()=>D),widthUnits:p,widthScale:f,widthMinPixels:m,widthMaxPixels:y,jointRounded:_,miterLimit:b,dashJustified:v,_pathType:"loop",transitions:d&&{getWidth:d.getLineWidth,getColor:d.getLineColor,getPath:d.getPolygon},getColor:this.getSubLayerAccessor(C),getWidth:this.getSubLayerAccessor(L),getDashArray:this.getSubLayerAccessor(x)},this.getSubLayerProps({id:"stroke",updateTriggers:k&&{getWidth:k.getLineWidth,getColor:k.getLineColor,getDashArray:k.getLineDashArray}}),{data:P,positionFormat:g,getPath:e=>e.path}),o&&T]}}(0,a.A)(f,"layerName","PolygonLayer"),(0,a.A)(f,"defaultProps",p);var m=n(66671),y=n(32548),_=n(98023),b=n.n(_),v=n(86914);function A(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function C(e){let t=e,n=e;function i(e,t,i,o){for(null==i&&(i=0),null==o&&(o=e.length);i<o;){const a=i+o>>>1;n(e[a],t)<0?i=a+1:o=a}return i}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>A(e(t),n)}(e)),{left:i,center:function(e,n,o,a){null==o&&(o=0),null==a&&(a=e.length);const l=i(e,n,o,a-1);return l>o&&t(e[l-1],n)>-t(e[l],n)?l-1:l},right:function(e,t,i,o){for(null==i&&(i=0),null==o&&(o=e.length);i<o;){const a=i+o>>>1;n(e[a],t)>0?o=a:i=a+1}return i}}}const L=C(A),x=L.right,w=(L.left,C((function(e){return null===e?NaN:+e})).center,x);function S(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function k(){var e,t=[.5],n=[0,1],i=1;function o(o){return null!=o&&o<=o?n[w(t,o,0,i)]:e}return o.domain=function(e){return arguments.length?(t=Array.from(e),i=Math.min(t.length,n.length-1),o):t.slice()},o.range=function(e){return arguments.length?(n=Array.from(e),i=Math.min(t.length,n.length-1),o):n.slice()},o.invertExtent=function(e){var i=n.indexOf(e);return[t[i-1],t[i]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return k().domain(t).range(n).unknown(e)},S.apply(o,arguments)}var F=n(30885),P=n(69161),D=n(49443);const W=10;function M({break_points:e,num_buckets:t},n,i){if(!n)return[];if(void 0===e||0===e.length){const e=t?parseInt(t,10):W,[o,a]=(0,v.extent)(n,i).map((e=>"string"==typeof e?parseFloat(e):e));if(void 0===o||void 0===a)return[];const l=(a-o)/e,r=0===l?0:Math.max(0,Math.ceil(Math.log10(1/l))),s=a>parseFloat(a.toFixed(r))?1:0,u=o<parseFloat(o.toFixed(r))?o-1:o;return new Array(e+1+s).fill(0).map(((e,t)=>(u+t*l).toFixed(r)))}return e.sort(((e,t)=>parseFloat(e)-parseFloat(t)))}function T({break_points:e,num_buckets:t,linear_color_scheme:n,opacity:i},o,a){const l=e||t?M({break_points:e,num_buckets:t},o,a):null,r=Array.isArray(n)?new F.A({colors:n,id:"custom"}):(0,P.A)().get(n);if(!r)return null;let s,u;if(null!==l){const e=l.length-1,t=e>1?r.getColors(e):[r.colors[r.colors.length-1]],n=t[0],i=t[t.length-1];t.unshift(n),t.push(i);const o=l.map(parseFloat);s=k().domain(o).range(t),u=t=>!!t&&(t>o[e]||t<o[0])}else{const e=(0,v.extent)(o,a);s=e.some(b())?r.createLinearScale((0,v.extent)(o,a)):r.createLinearScale(),u=()=>!1}return e=>{const t=a(e);if(!t)return[0,0,0,0];const n=(0,D.hexToRGB)(s(t));return u(t)?n[3]=0:n[3]=i/100*255,n}}var E=n(41857),R=n(25564);function j(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var z=n(95490),N=n(70957),Y=n(17437);function $(e,t,n,i,a,l){const r=e,s=r.fill_color_picker,u=r.stroke_color_picker;let c=[...t.data.features];r.js_data_mutator&&(c=(0,R.A)(r.js_data_mutator)(c));const d=r.metric?r.metric.label||r.metric:null,g=null===r.metric?()=>[s.r,s.g,s.b,255*s.a]:T(r,c,(e=>e[d])),h=e=>{const t=(null==g?void 0:g(e))||[0,0,0,0];return a.length>0&&!a.includes(e[r.line_column])&&(t[3]/=2),t},p=r.line_column&&r.metric&&["json","geohash","zipcode"].includes(r.line_type)?function(e){return t=>{var n,i,a,l;const r=(null==e||null==(n=e.metric)?void 0:n.label)||(null==e?void 0:e.metric);return(0,Y.Y)("div",{className:"deckgl-tooltip"},(null==(i=t.object)?void 0:i.name)&&(0,Y.Y)(y.A,{label:(0,o.t)("name")+": ",value:`${t.object.name}`}),(null==(a=t.object)?void 0:a[null==e?void 0:e.line_column])&&(0,Y.Y)(y.A,{label:`${e.line_column}: `,value:`${t.object[e.line_column]}`}),(null==e?void 0:e.metric)&&(0,Y.Y)(y.A,{label:`${r}: `,value:`${null==(l=t.object)?void 0:l[r]}`}))}}(r):()=>null;return new f({id:`path-layer-${r.slice_id}`,data:c,filled:r.filled,stroked:r.stroked,getPolygon:j,getFillColor:h,getLineColor:[u.r,u.g,u.b,255*u.a],getLineWidth:r.line_width,extruded:r.extruded,lineWidthUnits:r.line_width_unit,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,h),elevationScale:r.multiplier,fp64:!0,...(0,E.T)(r,i,p,l)})}const I=e=>{const t=(0,i.useRef)(),n=(0,i.useCallback)((()=>{let t={...e.viewport};if(e.formData.autozoom){const n=e.payload.data.features||[];t=(0,z.A)(t,{width:e.width,height:e.height,points:n.flatMap(j)})}return t.zoom<0&&(t.zoom=0),t}),[e]),[o,a]=(0,i.useState)(0),[l,r]=(0,i.useState)(n()),[s,u]=(0,i.useState)(e.payload.form_data),[c,d]=(0,i.useState)([]);(0,i.useEffect)((()=>{const{payload:t}=e;t.form_data!==s&&(r(n()),d([]),a(0),u(t.form_data))}),[n,e,s,l]);const g=(0,i.useCallback)((e=>{const{current:n}=t;n&&n.setTooltip(e)}),[]),h=(0,i.useCallback)((t=>{const{formData:n,onAddFilter:i}=e,l=(new Date).getDate(),r=l-o<=250,s=[...c];if(r)s.splice(0,s.length,t);else if(n.toggle_polygons){const e=s.indexOf(t);-1===e?s.push(t):s.splice(e,1)}else s.splice(0,1,t);d(s),a(l),n.table_filter&&i(n.line_column,c,!1,!0)}),[o,e,c]),p=(0,i.useCallback)((()=>void 0===e.payload.data.features?[]:[$(e.formData,e.payload,e.onAddFilter,g,c,h)]),[h,e.formData,e.onAddFilter,e.payload,c,g]),{payload:f,formData:y,setControlValue:_}=e,b=y.metric?y.metric.label||y.metric:null,v=function(e,t,n){const i=M(e,t,n),o=T(e,t,n),a={};return i.slice(1).forEach(((t,n)=>{const l=`${i[n]} - ${i[n+1]}`,r=.5*(parseFloat(i[n])+parseFloat(i[n+1])),s=e.metric?e.metric.label||e.metric:null;a[l]={color:null==o?void 0:o({[s||e.metric]:r}),enabled:!0}})),a}(y,f.data.features,(e=>e[b]));return(0,Y.Y)("div",{style:{position:"relative"}},(0,Y.Y)(N.S,{ref:t,viewport:l,layers:p(),setControlValue:_,mapStyle:y.mapbox_style,mapboxApiAccessToken:f.data.mapboxApiKey,width:e.width,height:e.height}),null!==y.metric&&(0,Y.Y)(m.A,{categories:v,position:y.legend_position,format:y.legend_format}))},J=(0,i.memo)(I)}}]);
//# sourceMappingURL=fa0a37b573c6637020b7.chunk.js.map