"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5423],{69945:(e,a,t)=>{t.d(a,{A:()=>r});var n=t(97032),l=(t(96540),t(90017)),o=t(4183),s=t(17437);const r=(0,l.A)((({textColor:e,color:a,text:t,...l})=>(0,s.Y)(o.A,(0,n.A)({text:t,color:t?a:void 0},l))))`
  & > sup {
    padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    background: ${({theme:e,color:a})=>a||e.colors.primary.base};
    color: ${({theme:e,textColor:a})=>a||e.colors.grayscale.light5};
  }
`},69732:(e,a,t)=>{t.d(a,{A:()=>S});var n=t(96540),l=t(90017),o=t(35742),s=t(95579),r=t(58561),i=t.n(r),d=t(15595),c=t(2738),u=t(40563),m=t(83329),p=t(5261),b=t(45412),h=t(17437);const v=l.A.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.gridUnit}px;\n      margin-top: ${5*e.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .select {\n      width: calc(100% - 30px - ${e.gridUnit}px);\n      flex: 1;\n    }\n\n    & > div {\n      margin-bottom: ${4*e.gridUnit}px;\n    }\n  `}
`,g=l.A.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-left: ${({theme:e})=>e.gridUnit-2}px;

  .backend {
    overflow: visible;
  }

  .name {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,f=({backend:e,databaseName:a})=>(0,h.Y)(g,null,(0,h.Y)(c.A,{className:"backend"},e||""),(0,h.Y)("span",{className:"name",title:a},a)),y=[];function S({db:e,formMode:a=!1,emptyState:t,getDbList:l,handleError:r,isDatabaseSelectEnabled:c=!0,onDbChange:g,onEmptyResults:S,onSchemaChange:Y,readOnly:w=!1,schema:x,sqlLabMode:C=!1}){const[_,A]=(0,n.useState)(),[$,k]=(0,n.useState)(x?{label:x,value:x,title:x}:void 0),L=(0,n.useRef)(x);L.current=x;const{addSuccessToast:N}=(0,p.Yf)(),E=(0,n.useCallback)(((e,a)=>e.order-a.order),[]),q=(0,n.useMemo)((()=>async(e,t,n)=>{const s=`/api/v1/database/?q=${i().encode({order_column:"database_name",order_direction:"asc",page:t,page_size:n,...a||!C?{filters:[{col:"database_name",opr:"ct",value:e}]}:{filters:[{col:"database_name",opr:"ct",value:e},{col:"expose_in_sqllab",opr:"eq",value:!0}]}})}`;return o.A.get({endpoint:s}).then((({json:a})=>{const{result:t,count:n}=a;l&&l(t),0===t.length&&S&&S(e);const o=t.map(((e,a)=>({label:(0,h.Y)(f,{backend:e.backend,databaseName:e.database_name}),value:e.id,id:e.id,database_name:e.database_name,backend:e.backend,order:a})));return{data:o,totalCount:null!=n?n:o.length}}))}),[a,l,C]);function R(e){k(e),Y&&(null==e?void 0:e.value)!==L.current&&Y(null==e?void 0:e.value)}(0,n.useEffect)((()=>{A((a=>(null==a?void 0:a.id)!==(null==e?void 0:e.id)?e?{label:(0,h.Y)(f,{backend:e.backend,databaseName:e.database_name}),value:e.id,...e}:void 0:a))}),[e]);const{data:T,isFetching:D,refetch:M}=(0,b.Ip)({dbId:null==_?void 0:_.value,onSuccess:(e,a)=>{1===e.length?R(e[0]):e.find((e=>L.current===e.value))||R(void 0),a&&N("List refreshed")},onError:()=>r((0,s.t)("There was an error loading the schemas"))}),I=T||y;function O(e,a){return(0,h.Y)("div",{className:"section"},(0,h.Y)("span",{className:"select"},e),(0,h.Y)("span",{className:"refresh"},a))}return(0,h.Y)(v,{"data-test":"DatabaseSelector"},O((0,h.Y)(d.DW,{ariaLabel:(0,s.t)("Select database or type to search databases"),optionFilterProps:["database_name","value"],"data-test":"select-database",header:(0,h.Y)(u.lR,null,(0,s.t)("Database")),lazyLoading:!1,notFoundContent:t,onChange:function(e,a){A(a),k(void 0),g&&g(a),Y&&Y(void 0)},value:_,placeholder:(0,s.t)("Select database or type to search databases"),disabled:!c||w,options:q,sortComparator:E}),null),function(){const e=!w&&(0,h.Y)(m.A,{onClick:()=>M(),tooltipContent:(0,s.t)("Force refresh schema list")});return O((0,h.Y)(d.l6,{ariaLabel:(0,s.t)("Select schema or type to search schemas"),disabled:!_||w,header:(0,h.Y)(u.lR,null,(0,s.t)("Schema")),labelInValue:!0,loading:D,name:"select-schema",notFoundContent:(0,s.t)("No compatible schema found"),placeholder:(0,s.t)("Select schema or type to search schemas"),onChange:e=>R(e),options:I,showSearch:!0,value:$}),e)}())}},83329:(e,a,t)=>{t.d(a,{A:()=>r});var n=t(96540),l=t(19129),o=t(12249),s=t(17437);const r=({onClick:e,tooltipContent:a})=>{const t=(0,n.forwardRef)(((e,a)=>(0,s.Y)(o.A.Refresh,e)));return(0,s.Y)(l.m,{title:a},(0,s.Y)(t,{role:"button",onClick:e,css:e=>({cursor:"pointer",color:e.colors.grayscale.base,"&:hover":{color:e.colors.primary.base}})}))}},8791:(e,a,t)=>{t.d(a,{Ay:()=>x,Kt:()=>w,cs:()=>S});var n=t(97032),l=t(96540),o=t(90017),s=t(95579),r=t(15595),i=t(40563),d=t(12249),c=t(69732),u=t(83329),m=t(58132),p=t(78704),b=t(5261),h=t(45412),v=t(94146),g=t(17437);const f=o.A.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.gridUnit}px;\n      margin-top: ${5*e.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .divider {\n      border-bottom: 1px solid ${e.colors.secondary.light5};\n      margin: 15px 0;\n    }\n\n    .table-length {\n      color: ${e.colors.grayscale.light1};\n    }\n\n    .select {\n      flex: 1;\n      max-width: calc(100% - ${e.gridUnit+30}px)\n    }\n  `}
`,y=o.A.span`
  align-items: center;
  display: flex;
  white-space: nowrap;

  svg,
  small {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,S=({table:e})=>{const{value:a,type:t,extra:n}=e;return(0,g.Y)(y,{title:a},"view"===t?(0,g.Y)(d.A.Eye,{iconSize:"m"}):(0,g.Y)(d.A.Table,{iconSize:"m"}),(null==n?void 0:n.certification)&&(0,g.Y)(m.A,{certifiedBy:n.certification.certified_by,details:n.certification.details,size:"l"}),(null==n?void 0:n.warning_markdown)&&(0,g.Y)(p.A,{warningMarkdown:n.warning_markdown,size:"l",marginRight:4}),a)},Y=({database:e,emptyState:a,formMode:t=!1,getDbList:n,handleError:o,isDatabaseSelectEnabled:d=!0,onDbChange:m,onSchemaChange:p,readOnly:y=!1,onEmptyResults:Y,schema:w,sqlLabMode:x=!0,tableSelectMode:C="single",tableValue:_,onTableSelectChange:A,customTableOptionLabelRenderer:$})=>{const{addSuccessToast:k}=(0,b.Yf)(),[L,N]=(0,l.useState)(w),[E,q]=(0,l.useState)(void 0),{data:R,isFetching:T,refetch:D}=(0,h.ty)({dbId:null==e?void 0:e.id,schema:L,onSuccess:(e,a)=>{a&&k((0,s.t)("List updated"))},onError:e=>{(0,v.h4)(e).then((e=>{o((0,v.hi)((0,s.t)("There was an error loading the tables"),e))}))}}),M=(0,l.useMemo)((()=>R?R.options.map((e=>({value:e.value,label:(0,g.Y)(S,{table:e}),text:e.value,...$&&{customLabel:$(e)}}))):[]),[R,$]);(0,l.useEffect)((()=>{void 0===e&&(N(void 0),q(void 0))}),[e,C]),(0,l.useEffect)((()=>{q("single"===C?M.find((e=>e.value===_)):(null==M?void 0:M.filter((e=>e&&(null==_?void 0:_.includes(e.value)))))||[])}),[M,_,C]);const I=e=>{L?null==A||A(Array.isArray(e)?e.map((e=>null==e?void 0:e.value)):null==e?void 0:e.value,L):q(e)},O=(0,l.useMemo)((()=>(e,a)=>{const t=e.trim().toLowerCase(),{value:n}=a;return n.toLowerCase().includes(t)}),[]);return(0,g.Y)(f,null,(0,g.Y)(c.A,{db:e,emptyState:a,formMode:t,getDbList:n,handleError:o,onDbChange:y?void 0:e=>{m&&m(e)},onEmptyResults:Y,onSchemaChange:y?void 0:e=>{N(e),p&&p(e),I("single"===C?void 0:[])},schema:L,sqlLabMode:x,isDatabaseSelectEnabled:d&&!y,readOnly:y}),x&&!t&&(0,g.Y)("div",{className:"divider"}),function(){const e=L&&!t&&y||!L,a=x?(0,g.Y)(i.lR,null,(0,s.t)("See table schema")):(0,g.Y)(i.lR,null,(0,s.t)("Table"));return n=(0,g.Y)(r.l6,{ariaLabel:(0,s.t)("Select table or type to search tables"),disabled:e,filterOption:O,header:a,labelInValue:!0,loading:T,name:"select-table",onChange:e=>I(e),options:M,placeholder:(0,s.t)("Select table or type to search tables"),showSearch:!0,mode:C,value:E,allowClear:"multiple"===C,allowSelectAll:!1}),l=!y&&(0,g.Y)(u.A,{onClick:()=>D(),tooltipContent:(0,s.t)("Force refresh table list")}),(0,g.Y)("div",{className:"section"},(0,g.Y)("span",{className:"select"},n),(0,g.Y)("span",{className:"refresh"},l));var n,l}())},w=e=>(0,g.Y)(Y,(0,n.A)({tableSelectMode:"multiple"},e)),x=Y},45412:(e,a,t)=>{t.d(a,{IX:()=>p.IX,hT:()=>n.hT,PG:()=>m.PG,RG:()=>i,MZ:()=>d,DT:()=>c,RO:()=>u,IV:()=>h,Ip:()=>p.Ip,ii:()=>m.ii,rq:()=>m.rq,ty:()=>m.ty});var n=t(51066),l=t(86274),o=t(58561);function s({owners:e}){return e?e.map((e=>`${e.first_name} ${e.last_name}`)):null}const r=t.n(o)().encode({columns:["owners.first_name","owners.last_name"],keys:["none"]});function i(e){return(0,l.vL)((0,l.b5)(`/api/v1/chart/${e}?q=${r}`),s)}const d=e=>(0,l.vL)((0,l.b5)(`/api/v1/dashboard/${e}`),(e=>({...e,metadata:e.json_metadata&&JSON.parse(e.json_metadata)||{},position_data:e.position_json&&JSON.parse(e.position_json),owners:e.owners||[]}))),c=e=>(0,l.b5)(`/api/v1/dashboard/${e}/charts`),u=e=>(0,l.b5)(`/api/v1/dashboard/${e}/datasets`);var m=t(42242),p=t(3247);const b=t(43031).F.injectEndpoints({endpoints:e=>({queryValidations:e.query({providesTags:["QueryValidations"],query:({dbId:e,schema:a,sql:t,templateParams:n})=>{let l=n;try{l=JSON.parse(n||"")}catch(e){l=void 0}const o={schema:a,sql:t,...l&&{template_params:l}};return{method:"post",endpoint:`/api/v1/database/${e}/validate_sql/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(o),transformResponse:({json:e})=>e.result}}})})}),{useQueryValidationsQuery:h}=b}}]);
//# sourceMappingURL=ae20e4fca308f39ce04d.chunk.js.map