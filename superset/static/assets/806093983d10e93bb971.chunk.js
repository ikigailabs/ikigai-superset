"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3665],{62703:(e,t,a)=>{a.d(t,{A:()=>Ue});var o,n=a(61225),r=a(82960),i=a(2514),s=a(7735),l=a(97032),c=a(5556),d=a.n(c),u=a(96540),p=a(95579),h=a(90017),m=a(5362),g=a(62952),v=a(27366),b=a(73212),f=a(17444),y=a(87196),x=a(49544),A=a(35700),C=a(27023),S=a(32132),T=a(92201);!function(e){e.Explore="explore",e.Dashboard="dashboard"}(o||(o={}));var Y,_=a(86274),w=a(88055),F=a.n(w),E=a(2404),D=a.n(E),M=a(4124),$=a.n(M),I=a(58863),R=a(80145),k=a(28846),O=a(17437),N=a(40961),q=a(96453),U=a(84666),L=a(6749),j=a(15595),P=a(95004),H=a(44230),z=a(83537),V=a(67429),W=a(12249),B=a(90868),G=a(5261),Q=a(35233),X=a(13270),J=a(54625),K=a(85861),Z=a(46920),ee=a(94229),te=a(60237),ae=a(59838),oe=a(55976),ne=a(25946),re=a(85183);function ie({formData:e,result:t,dataset:a,onContextMenu:o,inContextMenu:n}){const r=(0,u.useMemo)((()=>({onContextMenu:o})),[o]);return(0,O.Y)("div",{css:O.AH`
        width: 100%;
        height: 100%;
        min-height: 0;
      `,"data-test":"drill-by-chart"},(0,O.Y)(k.A,{disableErrorBoundary:!0,chartType:e.viz_type,enableNoResults:!0,datasource:a,formData:e,queriesData:t,hooks:r,inContextMenu:n,height:"100%",width:"100%"}))}!function(e){e[e.Chart=0]="Chart",e[e.Table=1]="Table"}(Y||(Y={}));var se=a(78697),le=a(15151);const ce=(0,h.A)(j.BD.Item)`
  ${({theme:e,isClickable:t,isHidden:a})=>O.AH`
    cursor: ${t?"pointer":"auto"};
    color: ${e.colors.grayscale.light1};
    transition: color ease-in ${e.transitionTiming}s;
    .ant-breadcrumb > span:last-child > & {
      color: ${e.colors.grayscale.dark1};
    }
    &:hover {
      color: ${t?e.colors.grayscale.dark1:"inherit"};
    }
    visibility: ${a?"hidden":"visible"};
  `}
`;var de=a(8877),ue=a(48327);const pe=h.A.div`
  ${({theme:e})=>O.AH`
    & .pagination-container {
      bottom: ${4*-e.gridUnit}px;
    }
  `}
`,he="adhoc_filters",me=({formData:e,closeModal:t})=>{const a=(0,n.wA)(),{addDangerToast:o}=(0,G.Yf)(),r=(0,q.DP)(),[i,l]=(0,u.useState)(""),c=(0,u.useContext)(ee.DashboardPageIdContext),d=(0,u.useCallback)((()=>{a((0,s.logEvent)(A.Ro,{slice_id:e.slice_id}))}),[a,e.slice_id]),h=(0,n.d4)((e=>{var t;return(0,U.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),[m,g]=e.datasource.split("__");(0,u.useEffect)((()=>{(0,te.T3)(Number(m),g,e,0).then((e=>{l(`/explore/?form_data_key=${e}&dashboard_page_id=${c}`)})).catch((()=>{o((0,p.t)("Failed to generate chart edit URL"))}))}),[o,c,m,g,e]);const v=!i||!h;return(0,O.Y)(u.Fragment,null,(0,O.Y)(Z.A,{buttonStyle:"secondary",buttonSize:"small",onClick:d,disabled:v,tooltip:v?(0,p.t)("You do not have sufficient permissions to edit the chart"):void 0},(0,O.Y)(J.N_,{css:O.AH`
            &:hover {
              text-decoration: none;
            }
          `,to:i},(0,p.t)("Edit chart"))),(0,O.Y)(Z.A,{buttonStyle:"primary",buttonSize:"small",onClick:t,"data-test":"close-drill-by-modal",css:O.AH`
          margin-left: ${2*r.gridUnit}px;
        `},(0,p.t)("Close")))};function ge({column:e,dataset:t,drillByConfig:a,formData:o,onHideModal:r}){const l=(0,n.wA)(),c=(0,q.DP)(),{addDangerToast:d}=(0,G.Yf)(),[h,m]=(0,u.useState)(!0),[v,b]=(0,u.useState)([{...a,column:e}]);(0,u.useEffect)((()=>{l((0,s.logEvent)(A.bD,{slice_id:o.slice_id}))}),[l,o.slice_id]);const{column:y,groupbyFieldName:x=a.groupbyFieldName}=v[v.length-1]||{},C=(0,u.useMemo)((()=>(0,g.A)(o[x]).map((e=>{var a;return null==(a=t.columns)?void 0:a.find((t=>t.column_name===e))})).filter(X.A)),[t.columns,o,x]),{displayModeToggle:S,drillByDisplayMode:T}=(()=>{const[e,t]=(0,u.useState)(Y.Chart);return{displayModeToggle:(0,u.useMemo)((()=>(0,O.Y)("div",{css:e=>O.AH`
          margin-bottom: ${6*e.gridUnit}px;
          .ant-radio-button-wrapper-checked:not(
              .ant-radio-button-wrapper-disabled
            ):focus-within {
            box-shadow: none;
          }
        `,"data-test":"drill-by-display-toggle"},(0,O.Y)(se.s.Group,{onChange:({target:{value:e}})=>{t(e)},defaultValue:Y.Chart},(0,O.Y)(se.s.Button,{value:Y.Chart,"data-test":"drill-by-chart-radio"},(0,p.t)("Chart")),(0,O.Y)(se.s.Button,{value:Y.Table,"data-test":"drill-by-table-radio"},(0,p.t)("Table"))))),[]),drillByDisplayMode:e}})(),[_,w]=(0,u.useState)(),F=((e,t)=>(0,X.A)(e)?1===e.length?(0,O.Y)(pe,{"data-test":"drill-by-results-table"},(0,O.Y)(de.U,{colnames:e[0].colnames,coltypes:e[0].coltypes,rowcount:e[0].sql_rowcount,data:e[0].data,dataSize:15,datasourceId:t,isVisible:!0})):(0,O.Y)(ue.Ay,{fullWidth:!1,"data-test":"drill-by-results-tabs"},e.map(((e,a)=>(0,O.Y)(ue.Ay.TabPane,{tab:(0,p.t)("Results %s",a+1),key:a},(0,O.Y)(pe,null,(0,O.Y)(de.U,{colnames:e.colnames,coltypes:e.coltypes,data:e.data,rowcount:e.sql_rowcount,dataSize:15,datasourceId:t,isVisible:!0})))))):(0,O.Y)("div",null))(_,o.datasource),[E,D]=(0,u.useState)(o),[M,$]=(0,u.useState)([...C,e].filter(X.A)),[I,R]=(0,u.useState)([{groupby:C,filters:a.filters},{groupby:e||[]}]),k=(0,u.useCallback)(((e,t=x)=>Array.isArray(o[t])?[e.column_name]:e.column_name),[o,x]),N=(0,u.useCallback)((e=>e.reduce(((e,t)=>{null!=t&&t.groupbyFieldName&&t.column&&(e.formData[t.groupbyFieldName]=k(t.column,t.groupbyFieldName),e.overridenGroupbyFields.add(t.groupbyFieldName));const a=(null==t?void 0:t.adhocFilterFieldName)||he;return e.formData[a]=[...(0,g.A)(e[a]),...(0,g.A)(t.filters).map((e=>(0,ae.r)(e)))],e.overridenAdhocFilterFields.add(a),e}),{formData:{},overridenGroupbyFields:new Set,overridenAdhocFilterFields:new Set})),[k]),U=(0,u.useCallback)((()=>v.reduce(((e,t)=>{const a=t.adhocFilterFieldName||he;return e[a]=[...e[a]||[],...t.filters.map((e=>(0,ae.r)(e)))],e}),{})),[v]),L=((e,t=le.fZ)=>(0,u.useMemo)((()=>{const a=t=>t<e.length-1;return(0,O.Y)(j.BD,{css:e=>O.AH`
          margin: ${2*e.gridUnit}px 0 ${4*e.gridUnit}px;
        `},e.map(((e,o)=>{return(0,O.Y)(ce,{key:o,isClickable:a(o),isHidden:(n=e,0===(0,g.A)(n.groupby).length&&0===(0,g.A)(n.filters).length),onClick:a(o)?()=>t(e,o):le.fZ,"data-test":"drill-by-breadcrumb-item"},(e=>`${(0,g.A)(e.groupby).map((e=>e.verbose_name||e.column_name)).join(", ")} ${e.filters?`(${e.filters.map((e=>e.formattedVal||e.val)).join(", ")})`:""}`)(e));var n})).filter((e=>!1===e.props.isHidden)))}),[e,t]))(I,(0,u.useCallback)(((e,t)=>{l((0,s.logEvent)(A.g$,{slice_id:o.slice_id})),b((e=>e.slice(0,t))),R((e=>{const a=e.slice(0,t+1);return delete a[a.length-1].filters,a})),$((e=>e.slice(0,t))),D((()=>{if(0===t)return o;const{formData:e,overridenAdhocFilterFields:a}=N(v.slice(0,t)),n={...o,...e};return a.forEach((t=>({...n,[t]:[...o[t],...e[t]]}))),n}))}),[l,v,o,N])),P=(0,u.useMemo)((()=>{let e={...E};y&&x&&(e[x]=k(y));const t=U();return Object.keys(t).forEach((a=>{e={...e,[a]:[...(0,g.A)(o[a]),...t[a]]}})),e.slice_id=0,delete e.slice_name,delete e.dashboards,e}),[E,y,x,U,k,o]);(0,u.useEffect)((()=>{$((e=>!y||e.some((e=>e.column_name===y.column_name))?e:[...e,y]))}),[y]);const H=(0,u.useCallback)(((e,t)=>{l((0,s.logEvent)(A.gi,{drill_depth:v.length+1,slice_id:o.slice_id})),D(P),b((a=>[...a,{...t,column:e}])),R((a=>{const o=[...a,{groupby:e}];return o[o.length-2].filters=t.filters,o}))}),[l,v.length,P,o.slice_id]),z=(0,u.useMemo)((()=>({drillBy:{excludedColumns:M,openNewModal:!1}})),[M]),{contextMenu:V,inContextMenu:W,onContextMenu:B}=((e,t,a,o,n)=>{const r=(0,u.useRef)(null),[i,s]=(0,u.useState)(!1),l=(0,u.useCallback)(((...e)=>{s(!1),null==a||a(...e)}),[a]),c=(0,u.useCallback)((()=>{s(!1)}),[]);return{contextMenu:(0,u.useMemo)((()=>(0,O.Y)(xe,{ref:r,id:0,formData:t,onSelection:l,onClose:c,displayedItems:o,additionalConfig:n})),[n,0,o,t,c,l]),inContextMenu:i,onContextMenu:(e,t,a)=>{var o;null==(o=r.current)||o.open(e,t,a),s(!0)}}})(0,E,H,fe.DrillBy,z),Q=(0,n.d4)((e=>{const t=Object.values(e.dashboardLayout.present).find((e=>{var t;return(null==(t=e.meta)?void 0:t.chartId)===o.slice_id}));return(null==t?void 0:t.meta.sliceNameOverride)||(null==t?void 0:t.meta.sliceName)}));(0,u.useEffect)((()=>{if(P){const[e]=(0,re.Mp)(P);m(!0),w(void 0),(0,i.getChartDataRequest)({formData:P}).then((({response:t,json:a})=>(0,i.handleChartDataResponse)(t,a,e))).then((e=>{w(e)})).catch((()=>{d((0,p.t)("Failed to load chart data."))})).finally((()=>{m(!1)}))}}),[d,P]);const{metadataBar:J}=(0,oe.M)({dataset:t});return(0,O.Y)(K.A,{css:O.AH`
        .ant-modal-footer {
          border-top: none;
        }
      `,show:!0,onHide:null!=r?r:()=>null,title:(0,p.t)("Drill by: %s",Q),footer:(0,O.Y)(me,{formData:P}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*c.gridUnit,minWidth:128*c.gridUnit,defaultSize:{width:"auto",height:"80vh"}},draggable:!0,destroyOnClose:!0,maskClosable:!1},(0,O.Y)("div",{css:O.AH`
          display: flex;
          flex-direction: column;
          height: 100%;
        `},J,L,S,h&&(0,O.Y)(f.A,null),!h&&!_&&(0,O.Y)(ne.A,{type:"error",message:(0,p.t)("There was an error loading the chart data")}),T===Y.Chart&&_&&(0,O.Y)(ie,{dataset:t,formData:P,result:_,onContextMenu:B,inContextMenu:W}),T===Y.Table&&_&&F,V))}var ve=a(28543);const be=({drillByConfig:e,formData:t,contextMenuY:a=0,submenuIndex:o=0,onSelection:n=(()=>{}),onClick:r=(()=>{}),excludedColumns:i,openNewModal:s=!0,...c})=>{const d=(0,q.DP)(),{addDangerToast:h}=(0,G.Yf)(),[m,v]=(0,u.useState)(!0),[b,y]=(0,u.useState)(""),[x,A]=(0,u.useState)(),[C,S]=(0,u.useState)([]),[T,Y]=(0,u.useState)(!1),[_,w]=(0,u.useState)(),F=(0,u.useCallback)(((t,a)=>{r(t),n(a,e),w(a),s&&Y(!0)}),[e,r,n,s]),E=(0,u.useCallback)((()=>{Y(!1)}),[]);(0,u.useEffect)((()=>{y("")}),[C.length]);const D=null==e?void 0:e.groupbyFieldName,M=(0,u.useMemo)((()=>{var e;return null==(e=(0,R.A)().get(t.viz_type))?void 0:e.behaviors.find((e=>e===I.nS.DrillBy))}),[t.viz_type]),$=(e=>{const t={};return(0,g.A)(null==e?void 0:e.columns).forEach((e=>{t[e.column_name]=e.verbose_name||e.column_name})),(0,g.A)(null==e?void 0:e.metrics).forEach((e=>{t[e.metric_name]=e.verbose_name||e.metric_name})),t})(x);(0,u.useEffect)((()=>{if(M&&D){const a=t.datasource.split("__")[0];(0,Q.w)({endpoint:`/api/v1/dataset/${a}`}).then((({json:{result:a}})=>{A(a),S((0,g.A)(a.columns).filter((e=>e.groupby)).filter((a=>{var o,n;return!(0,g.A)(t[null!=(o=e.groupbyFieldName)?o:""]).includes(a.column_name)&&a.column_name!==t.x_axis&&(null==(n=(0,g.A)(i))?void 0:n.every((e=>e.column_name!==a.column_name)))})))})).catch((()=>{Q.e.delete(`/api/v1/dataset/${a}`),h((0,p.t)("Failed to load dimensions for drill by"))})).finally((()=>{v(!1)}))}}),[h,i,t,null==e?void 0:e.groupbyFieldName,M,D]);const k=(0,u.useCallback)((e=>{var t;e.stopPropagation();const a=null==e||null==(t=e.target)?void 0:t.value;y(a)}),[]),N=(0,u.useMemo)((()=>C.filter((e=>(e.verbose_name||e.column_name).toLowerCase().includes(b.toLowerCase())))),[C,b]),U=(0,u.useMemo)((()=>(0,z.Gs)(a,N.length||1,o,200,C.length>10?48:0)),[a,N.length,o,C.length]);let j;return M?D||(j=(0,p.t)("Drill by is not available for this data point")):j=(0,p.t)("Drill by is not yet supported for this chart type"),M&&D?(0,O.Y)(u.Fragment,null,(0,O.Y)(L.W.SubMenu,(0,l.A)({title:(0,p.t)("Drill by"),key:"drill-by-submenu",popupClassName:"chart-context-submenu",popupOffset:[0,U]},c),(0,O.Y)("div",{"data-test":"drill-by-submenu"},C.length>10&&(0,O.Y)(B.pd,{prefix:(0,O.Y)(W.A.Search,{iconSize:"l",iconColor:d.colors.grayscale.light1}),onChange:k,placeholder:(0,p.t)("Search columns"),value:b,onClick:e=>{e.nativeEvent.stopImmediatePropagation()},allowClear:!0,css:O.AH`
                width: auto;
                max-width: 100%;
                margin: ${2*d.gridUnit}px ${3*d.gridUnit}px;
                box-shadow: none;
              `}),m?(0,O.Y)("div",{css:O.AH`
                padding: ${3*d.gridUnit}px 0;
              `},(0,O.Y)(f.A,{position:"inline-centered"})):N.length?(0,O.Y)("div",{css:O.AH`
                max-height: ${200}px;
                overflow: auto;
              `},N.map((e=>(0,O.Y)(ve.o,(0,l.A)({key:`drill-by-item-${e.column_name}`,tooltipText:e.verbose_name||e.column_name},c,{onClick:t=>F(t,e)}),e.verbose_name||e.column_name)))):(0,O.Y)(L.W.Item,(0,l.A)({disabled:!0,key:"no-drill-by-columns-found"},c),(0,p.t)("No columns found")))),T&&(0,O.Y)(ge,{column:_,drillByConfig:e,formData:t,onHideModal:E,dataset:{...x,verbose_map:$}})):(0,O.Y)(L.W.Item,(0,l.A)({key:"drill-by-disabled",disabled:!0},c),(0,O.Y)("div",null,(0,p.t)("Drill by"),(0,O.Y)(V.C,{title:j})))};var fe;!function(e){e[e.CrossFilter=0]="CrossFilter",e[e.DrillToDetail=1]="DrillToDetail",e[e.DrillBy=2]="DrillBy",e[e.All=3]="All"}(fe||(fe={}));const ye=({id:e,formData:t,onSelection:a,onClose:o,displayedItems:r=fe.All,additionalConfig:i},s)=>{var c,d;const h=(0,q.DP)(),m=(0,n.wA)(),b=(0,n.d4)((e=>{var t;return(0,U.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),f=(0,n.d4)((e=>{var t;return(0,U.L)("can_write","ExploreFormDataRestApi",null==(t=e.user)?void 0:t.roles)})),y=(0,n.d4)((e=>{var t;return(0,U.L)("can_samples","Datasource",null==(t=e.user)?void 0:t.roles)})),x=b&&f,A=b&&y,C=(0,n.d4)((({dashboardInfo:e})=>e.crossFiltersEnabled)),S=e=>r===fe.All||(0,g.A)(r).includes(e),[{filters:T,clientX:Y,clientY:_},w]=(0,u.useState)({clientX:0,clientY:0}),F=[],E=(0,v.G7)(v.TO.DrillToDetail)&&A&&S(fe.DrillToDetail),D=(0,v.G7)(v.TO.DrillBy)&&x&&S(fe.DrillBy),M=(0,v.G7)(v.TO.DashboardCrossFilters)&&S(fe.CrossFilter),$=null==(c=(0,R.A)().get(t.viz_type))||null==(d=c.behaviors)?void 0:d.includes(I.nS.InteractiveChart);let k=0;if(M&&(k+=1),E&&(k+=2),D&&(k+=1),0===k&&(k=1),M){var W;const t=!$||!C||!(null!=T&&T.crossFilter);let a=null;t?C?$?null!=T&&T.crossFilter||(a=(0,O.Y)(u.Fragment,null,(0,O.Y)("div",null,(0,p.t)("You can't apply cross-filter on this data point.")))):a=(0,O.Y)(u.Fragment,null,(0,O.Y)("div",null,(0,p.t)("This visualization type does not support cross-filtering."))):a=(0,O.Y)(u.Fragment,null,(0,O.Y)("div",null,(0,p.t)("Cross-filtering is not enabled for this dashboard."))):a=(0,O.Y)(u.Fragment,null,(0,O.Y)("div",null,(0,p.t)("Cross-filter will be applied to all of the charts that use this dataset.")),(0,O.Y)("div",null,(0,p.t)("You can also just click on the chart to apply cross-filter."))),F.push((0,O.Y)(u.Fragment,null,(0,O.Y)(L.W.Item,{key:"cross-filtering-menu-item",disabled:t,onClick:()=>{null!=T&&T.crossFilter&&m((0,P.Mv)(e,T.crossFilter.dataMask))}},null!=T&&null!=(W=T.crossFilter)&&W.isCurrentValueSelected?(0,p.t)("Remove cross-filter"):(0,O.Y)("div",null,(0,p.t)("Add cross-filter"),(0,O.Y)(V.C,{title:a,color:t?void 0:h.colors.grayscale.base}))),k>1&&(0,O.Y)(L.W.Divider,null)))}if(E&&F.push((0,O.Y)(H.k,(0,l.A)({chartId:e,formData:t,filters:null==T?void 0:T.drillToDetail,isContextMenu:!0,contextMenuY:_,onSelection:a,submenuIndex:M?2:1},(null==i?void 0:i.drillToDetail)||{}))),D){let e=0;M&&(e+=1),E&&(e+=2),F.push((0,O.Y)(be,(0,l.A)({drillByConfig:null==T?void 0:T.drillBy,onSelection:a,formData:t,contextMenuY:_,submenuIndex:e},(null==i?void 0:i.drillBy)||{})))}const B=(0,u.useCallback)(((t,a,o)=>{var n;const r=(0,z.x4)(a,k);w({clientX:t,clientY:r,filters:o}),null==(n=document.getElementById(`hidden-span-${e}`))||n.click()}),[e,k]);return(0,u.useImperativeHandle)(s,(()=>({open:B})),[B]),N.createPortal((0,O.Y)(j.rM,{overlay:(0,O.Y)(L.W,{className:"chart-context-menu","data-test":"chart-context-menu"},F.length?F:(0,O.Y)(L.W.Item,{disabled:!0},"No actions")),trigger:["click"],onVisibleChange:e=>!e&&o()},(0,O.Y)("span",{id:`hidden-span-${e}`,css:(0,O.AH)({visibility:"hidden",position:"fixed",top:_,left:Y,width:1,height:1},"","")})),document.body)},xe=(0,u.forwardRef)(ye),Ae={annotationData:d().object,actions:d().object,chartId:d().number.isRequired,datasource:d().object,initialValues:d().object,formData:d().object.isRequired,latestQueryFormData:d().object,labelColors:d().object,sharedLabelColors:d().object,height:d().number,width:d().number,setControlValue:d().func,vizType:d().string.isRequired,triggerRender:d().bool,chartAlert:d().string,chartStatus:d().string,queriesResponse:d().arrayOf(d().object),triggerQuery:d().bool,chartIsStale:d().bool,addFilter:d().func,setDataMask:d().func,onFilterMenuOpen:d().func,onFilterMenuClose:d().func,ownState:d().object,postTransformProps:d().func,source:d().oneOf([o.Dashboard,o.Explore]),emitCrossFilters:d().bool},Ce={},Se=[I.nS.InteractiveChart],Te={addFilter:()=>Ce,onFilterMenuOpen:()=>Ce,onFilterMenuClose:()=>Ce,initialValues:Ce,setControlValue(){},triggerRender:!1};class Ye extends u.Component{constructor(e){super(e),this.state={showContextMenu:e.source===o.Dashboard&&((0,v.G7)(v.TO.DrillToDetail)||(0,v.G7)(v.TO.DashboardCrossFilters)),inContextMenu:!1,legendState:void 0},this.hasQueryResponseChange=!1,this.contextMenuRef=u.createRef(),this.handleAddFilter=this.handleAddFilter.bind(this),this.handleRenderSuccess=this.handleRenderSuccess.bind(this),this.handleRenderFailure=this.handleRenderFailure.bind(this),this.handleSetControlValue=this.handleSetControlValue.bind(this),this.handleOnContextMenu=this.handleOnContextMenu.bind(this),this.handleContextMenuSelected=this.handleContextMenuSelected.bind(this),this.handleContextMenuClosed=this.handleContextMenuClosed.bind(this),this.handleLegendStateChanged=this.handleLegendStateChanged.bind(this),this.onContextMenuFallback=this.onContextMenuFallback.bind(this),this.hooks={onAddFilter:this.handleAddFilter,onContextMenu:this.state.showContextMenu?this.handleOnContextMenu:void 0,onError:this.handleRenderFailure,setControlValue:this.handleSetControlValue,onFilterMenuOpen:this.props.onFilterMenuOpen,onFilterMenuClose:this.props.onFilterMenuClose,onLegendStateChanged:this.handleLegendStateChanged,setDataMask:e=>{var t;null==(t=this.props.actions)||t.updateDataMask(this.props.chartId,e)}},this.mutableQueriesResponse=F()(this.props.queriesResponse)}shouldComponentUpdate(e,t){var a,o;return!(!(e.queriesResponse&&["success","rendered"].indexOf(e.chartStatus)>-1)||null!=(a=e.queriesResponse)&&null!=(o=a[0])&&o.error)&&(!D()(this.state,t)||(this.hasQueryResponseChange=e.queriesResponse!==this.props.queriesResponse,this.hasQueryResponseChange&&(this.mutableQueriesResponse=F()(e.queriesResponse)),this.hasQueryResponseChange||!D()(e.datasource,this.props.datasource)||e.annotationData!==this.props.annotationData||e.ownState!==this.props.ownState||e.filterState!==this.props.filterState||e.height!==this.props.height||e.width!==this.props.width||e.triggerRender||e.labelColors!==this.props.labelColors||e.sharedLabelColors!==this.props.sharedLabelColors||e.formData.color_scheme!==this.props.formData.color_scheme||e.formData.stack!==this.props.formData.stack||e.cacheBusterProp!==this.props.cacheBusterProp||e.emitCrossFilters!==this.props.emitCrossFilters))}handleAddFilter(e,t,a=!0,o=!0){this.props.addFilter(e,t,a,o)}handleRenderSuccess(){const{actions:e,chartStatus:t,chartId:a,vizType:o}=this.props;["loading","rendered"].indexOf(t)<0&&e.chartRenderingSucceeded(a),this.hasQueryResponseChange&&e.logEvent(A.tE,{slice_id:a,viz_type:o,start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:A.Vy.getTimestamp()-this.renderStartTime})}handleRenderFailure(e,t){const{actions:a,chartId:o}=this.props;m.A.warn(e),a.chartRenderingFailed(e.toString(),o,t?t.componentStack:null),this.hasQueryResponseChange&&a.logEvent(A.tE,{slice_id:o,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:A.Vy.getTimestamp()-this.renderStartTime})}handleSetControlValue(...e){const{setControlValue:t}=this.props;t&&t(...e)}handleOnContextMenu(e,t,a){this.contextMenuRef.current.open(e,t,a),this.setState({inContextMenu:!0})}handleContextMenuSelected(){this.setState({inContextMenu:!1})}handleContextMenuClosed(){this.setState({inContextMenu:!1})}handleLegendStateChanged(e){this.setState({legendState:e})}onContextMenuFallback(e){this.state.inContextMenu||(e.preventDefault(),this.handleOnContextMenu(e.clientX,e.clientY))}render(){var e;const{chartAlert:t,chartStatus:a,chartId:n,emitCrossFilters:r}=this.props;if("loading"===a||t||null===a)return null;this.renderStartTime=A.Vy.getTimestamp();const{width:i,height:s,datasource:c,annotationData:d,initialValues:h,ownState:m,filterState:g,chartIsStale:v,formData:b,latestQueryFormData:f,postTransformProps:x}=this.props,C=v&&f?f:b,S=C.viz_type||this.props.vizType,T=$()(S),Y="table"===S?`superset-chart-${T}`:T;let _;const w=(0,p.t)("No results were returned for this query"),F=this.props.source===o.Explore?(0,p.t)("Make sure that the controls are configured properly and the datasource contains data for the selected time range"):void 0,E="chart.svg";_=i>300&&s>220?(0,O.Y)(y.nw,{title:w,description:F,image:E}):(0,O.Y)(y.u7,{title:w,image:E});const D=null!=(e=(0,R.A)().get(b.viz_type))&&e.behaviors.find((e=>e===I.nS.DrillToDetail))?{inContextMenu:this.state.inContextMenu}:{};return(0,O.Y)(u.Fragment,null,this.state.showContextMenu&&(0,O.Y)(xe,{ref:this.contextMenuRef,id:n,formData:C,onSelection:this.handleContextMenuSelected,onClose:this.handleContextMenuClosed}),(0,O.Y)("div",{onContextMenu:this.state.showContextMenu?this.onContextMenuFallback:void 0},(0,O.Y)(k.A,(0,l.A)({disableErrorBoundary:!0,key:`${n}`,id:`chart-id-${n}`,className:Y,chartType:S,width:i,height:s,annotationData:d,datasource:c,initialValues:h,formData:C,ownState:m,filterState:g,hooks:this.hooks,behaviors:Se,queriesData:this.mutableQueriesResponse,onRenderSuccess:this.handleRenderSuccess,onRenderFailure:this.handleRenderFailure,noResults:_,postTransformProps:x,emitCrossFilters:r,legendState:this.state.legendState},D))))}}Ye.propTypes=Ae,Ye.defaultProps=Te;const _e=Ye;var we=a(45412),Fe=a(79427);const Ee=({chartId:e,error:t,...a})=>{const{result:o}=(0,we.RG)(e),n=t&&{...t,extra:{...t.extra,owners:o}};return(0,O.Y)(Fe.A,(0,l.A)({},a,{error:n}))};var De=a(21357);const Me={annotationData:d().object,actions:d().object,chartId:d().number.isRequired,datasource:d().object,dashboardId:d().number,initialValues:d().object,formData:d().object.isRequired,labelColors:d().object,sharedLabelColors:d().object,width:d().number,height:d().number,setControlValue:d().func,timeout:d().number,vizType:d().string.isRequired,triggerRender:d().bool,force:d().bool,isFiltersInitialized:d().bool,chartAlert:d().string,chartStatus:d().string,chartStackTrace:d().string,queriesResponse:d().arrayOf(d().object),triggerQuery:d().bool,chartIsStale:d().bool,errorMessage:d().node,addFilter:d().func,onQuery:d().func,onFilterMenuOpen:d().func,onFilterMenuClose:d().func,ownState:d().object,postTransformProps:d().func,datasetsStatus:d().oneOf(["loading","error","complete"]),isInView:d().bool,emitCrossFilters:d().bool},$e={},Ie=(0,p.t)("The dataset associated with this chart no longer exists"),Re={addFilter:()=>$e,onFilterMenuOpen:()=>$e,onFilterMenuClose:()=>$e,initialValues:$e,setControlValue(){},triggerRender:!1,dashboardId:null,chartStackTrace:null,force:!1,isInView:!0},ke=h.A.div`
  min-height: ${e=>e.height}px;
  position: relative;

  .chart-tooltip {
    opacity: 0.75;
    font-size: ${({theme:e})=>e.typography.sizes.s}px;
  }

  .slice_container {
    display: flex;
    flex-direction: column;
    justify-content: center;

    height: ${e=>e.height}px;

    .pivot_table tbody tr {
      font-feature-settings: 'tnum' 1;
    }

    .alert {
      margin: ${({theme:e})=>2*e.gridUnit}px;
    }
  }
`,Oe=h.A.div`
  font-family: ${({theme:e})=>e.typography.families.monospace};
  word-break: break-word;
  overflow-x: auto;
  white-space: pre-wrap;
`;class Ne extends u.PureComponent{constructor(e){super(e),this.handleRenderContainerFailure=this.handleRenderContainerFailure.bind(this)}componentDidMount(){this.props.triggerQuery&&this.runQuery()}componentDidUpdate(){this.props.triggerQuery&&this.runQuery()}runQuery(){this.props.actions.postChartFormData(this.props.formData,Boolean(this.props.force||(0,S.P3)(C.vX.force)),this.props.timeout,this.props.chartId,this.props.dashboardId,this.props.ownState)}handleRenderContainerFailure(e,t){const{actions:a,chartId:o}=this.props;m.A.warn(e),a.chartRenderingFailed(e.toString(),o,t?t.componentStack:null),a.logEvent(A.tE,{slice_id:o,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:A.Vy.getTimestamp()-this.renderStartTime})}renderErrorMessage(e){var t;const{chartId:a,chartAlert:n,chartStackTrace:r,datasource:i,dashboardId:s,height:l,datasetsStatus:c}=this.props,d=null==e||null==(t=e.errors)?void 0:t[0],u=n||(null==e?void 0:e.message);return void 0!==n&&n!==Ie&&i===b.As&&c!==_.bk.Error?(0,O.Y)(ke,{key:a,"data-ui-anchor":"chart",className:"chart-container","data-test":"chart-container",height:l},(0,O.Y)(f.A,null)):(0,O.Y)(Ee,{key:a,chartId:a,error:d,subtitle:(0,O.Y)(Oe,null,u),copyText:u,link:e?e.link:null,source:s?o.Dashboard:o.Explore,stackTrace:r})}render(){const{height:e,chartAlert:t,chartStatus:a,errorMessage:o,chartIsStale:n,queriesResponse:r=[],width:i}=this.props,s="loading"===a;return this.renderContainerStartTime=A.Vy.getTimestamp(),"failed"===a?r.map((e=>this.renderErrorMessage(e))):o&&0===(0,g.A)(r).length?(0,O.Y)(y.nw,{title:(0,p.t)("Add required control values to preview chart"),description:(0,De.w)(!0),image:"chart.svg"}):s||t||o||!n||0!==(0,g.A)(r).length?(0,O.Y)(x.A,{onError:this.handleRenderContainerFailure,showMessage:!1},(0,O.Y)(ke,{"data-ui-anchor":"chart",className:"chart-container","data-test":"chart-container",height:e,width:i},(0,O.Y)("div",{className:"slice_container","data-test":"slice-container"},this.props.isInView||!(0,v.G7)(v.TO.DashboardVirtualization)||(0,T.a)()?(0,O.Y)(_e,(0,l.A)({},this.props,{source:this.props.dashboardId?"dashboard":"explore","data-test":this.props.vizType})):(0,O.Y)(f.A,null)),s&&(0,O.Y)(f.A,null))):(0,O.Y)(y.nw,{title:(0,p.t)("Your chart is ready to go!"),description:(0,O.Y)("span",null,(0,p.t)('Click on "Create chart" button in the control panel on the left to preview a visualization or')," ",(0,O.Y)("span",{role:"button",tabIndex:0,onClick:this.props.onQuery},(0,p.t)("click here")),"."),image:"chart.svg"})}}Ne.propTypes=Me,Ne.defaultProps=Re;const qe=Ne,Ue=(0,n.Ng)(null,(function(e){return{actions:(0,r.zH)({...i,updateDataMask:P.Mv,logEvent:s.logEvent},e)}}))(qe)},25671:(e,t,a)=>{a.d(t,{A:()=>R});var o=a(96540),n=a(5556),r=a.n(n),i=a(35742),s=a(5362),l=a(95579),c=a(62952),d=a(28176),u=a(50317),p=a(8901),h=a(32291),m=a(17093),g=a(95483),v=a(84064),b=a(72652),f=a(12249),y=a(85861),x=a(23133),A=a(28254),C=a(59638),S=a(17437);function T({adhocFilter:e,options:t,datasource:a,onFilterEdit:o,onRemoveFilter:n,partitionColumn:r,onMoveLabel:i,onDropLabel:s,index:l,sections:c,operators:d}){const{actualTimeRange:u,title:p}=(0,C.K)(e);return(0,S.Y)(x.A,{sections:c,operators:d,adhocFilter:e,options:t,datasource:a,onFilterEdit:o,partitionColumn:r},(0,S.Y)(b.Px,{label:null!=u?u:e.getDefaultLabel(),tooltipTitle:null!=p?p:e.getTooltipTitle(),onRemove:n,onMoveLabel:i,onDropLabel:s,index:l,type:A.S.FilterOption,withCaret:!0,isExtra:e.isExtra}))}var Y=a(90422),_=a(2511);const w=r().oneOfType([r().shape({expressionType:r().oneOf([_.A.Simple]).isRequired,clause:r().oneOf([_.v.Having,_.v.Where]).isRequired,subject:r().string.isRequired,comparator:r().oneOfType([r().string,r().arrayOf(r().string)]).isRequired}),r().shape({expressionType:r().oneOf([_.A.Sql]).isRequired,clause:r().oneOf([_.v.Where,_.v.Having]).isRequired,sqlExpression:r().string.isRequired})]);var F=a(21062);const{warning:E}=y.A,D=r().oneOfType([r().string,p.A]),M={label:r().oneOfType([r().object,r().string]),name:r().string,sections:r().arrayOf(r().string),operators:r().arrayOf(r().string),onChange:r().func,value:r().arrayOf(w),datasource:r().object,columns:r().arrayOf(F.A),savedMetrics:r().arrayOf(h.A),selectedMetrics:r().oneOfType([D,r().arrayOf(D)]),isLoading:r().bool,canDelete:r().func};function $(e){return e&&!(e instanceof Y.A)&&e.expressionType}class I extends o.Component{constructor(e){super(e),this.optionsForSelect=this.optionsForSelect.bind(this),this.onRemoveFilter=this.onRemoveFilter.bind(this),this.onNewFilter=this.onNewFilter.bind(this),this.onFilterEdit=this.onFilterEdit.bind(this),this.moveLabel=this.moveLabel.bind(this),this.onChange=this.onChange.bind(this),this.mapOption=this.mapOption.bind(this),this.getMetricExpression=this.getMetricExpression.bind(this),this.removeFilter=this.removeFilter.bind(this);const t=(this.props.value||[]).map((e=>$(e)?new Y.A(e):e));this.optionRenderer=e=>(0,S.Y)(v.A,{option:e}),this.valueRenderer=(e,t)=>(0,S.Y)(T,{key:t,index:t,adhocFilter:e,onFilterEdit:this.onFilterEdit,options:this.state.options,sections:this.props.sections,operators:this.props.operators,datasource:this.props.datasource,onRemoveFilter:e=>{e.stopPropagation(),this.onRemoveFilter(t)},onMoveLabel:this.moveLabel,onDropLabel:()=>this.props.onChange(this.state.values),partitionColumn:this.state.partitionColumn}),this.state={values:t,options:this.optionsForSelect(this.props),partitionColumn:null}}componentDidMount(){const{datasource:e}=this.props;if(e&&"table"===e.type){var t;const a=null==(t=e.database)?void 0:t.id,{datasource_name:o,schema:n,is_sqllab_view:r}=e;!r&&a&&o&&n&&i.A.get({endpoint:`/api/v1/database/${a}/table_extra/${o}/${n}/`}).then((({json:e})=>{if(e&&e.partitions){const{partitions:t}=e;t&&t.cols&&1===Object.keys(t.cols).length&&this.setState({partitionColumn:t.cols[0]})}})).catch((e=>{s.A.error("fetch extra_table_metadata:",e.statusText)}))}}UNSAFE_componentWillReceiveProps(e){this.props.columns!==e.columns&&this.setState({options:this.optionsForSelect(e)}),this.props.value!==e.value&&this.setState({values:(e.value||[]).map((e=>$(e)?new Y.A(e):e))})}removeFilter(e){const t=[...this.state.values];t.splice(e,1),this.setState((e=>({...e,values:t}))),this.props.onChange(t)}onRemoveFilter(e){const{canDelete:t}=this.props,{values:a}=this.state,o=null==t?void 0:t(a[e],a);"string"!=typeof o?this.removeFilter(e):E({title:(0,l.t)("Warning"),content:o})}onNewFilter(e){const t=this.mapOption(e);t&&this.setState((e=>({...e,values:[...e.values,t]})),(()=>{this.props.onChange(this.state.values)}))}onFilterEdit(e){this.props.onChange(this.state.values.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}onChange(e){const t=(e||[]).map((e=>this.mapOption(e))).filter((e=>e));this.props.onChange(t)}getMetricExpression(e){return this.props.savedMetrics.find((t=>t.metric_name===e)).expression}moveLabel(e,t){const{values:a}=this.state,o=[...a];[o[t],o[e]]=[o[e],o[t]],this.setState({values:o})}mapOption(e){return e instanceof Y.A?e:e.saved_metric_name?new Y.A({expressionType:_.A.Sql,subject:this.getMetricExpression(e.saved_metric_name),operator:g.nS[g.ux.GreaterThan].operation,comparator:0,clause:_.v.Having}):e.label?new Y.A({expressionType:_.A.Sql,subject:new m.A(e).translateToSql(),operator:g.nS[g.ux.GreaterThan].operation,comparator:0,clause:_.v.Having}):e.column_name?new Y.A({expressionType:_.A.Simple,subject:e.column_name,operator:g.nS[g.ux.Equals].operation,comparator:"",clause:_.v.Where,isNew:!0}):null}optionsForSelect(e){return[...e.columns,...(0,c.A)(e.selectedMetrics).map((e=>e&&("string"==typeof e?{saved_metric_name:e}:new m.A(e))))].filter((e=>e)).reduce(((e,t)=>(t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof m.A&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label)))}addNewFilterPopoverTrigger(e){return(0,S.Y)(x.A,{operators:this.props.operators,sections:this.props.sections,adhocFilter:new Y.A({}),datasource:this.props.datasource,options:this.state.options,onFilterEdit:this.onNewFilter,partitionColumn:this.state.partitionColumn},e)}render(){const{theme:e}=this.props;return(0,S.Y)("div",{className:"metrics-select","data-test":"adhoc-filter-control"},(0,S.Y)(b.B3,null,(0,S.Y)(u.A,this.props),this.addNewFilterPopoverTrigger((0,S.Y)(b.XB,{"data-test":"add-filter-button"},(0,S.Y)(f.A.PlusLarge,{iconSize:"s",iconColor:e.colors.grayscale.light5})))),(0,S.Y)(b.p6,null,this.state.values.length>0?this.state.values.map(((e,t)=>this.valueRenderer(e,t))):this.addNewFilterPopoverTrigger((0,S.Y)(b.JG,null,(0,S.Y)(f.A.PlusSmall,{iconColor:e.colors.grayscale.light1}),(0,l.t)("Add filter")))))}}I.propTypes=M,I.defaultProps={name:"",onChange:()=>{},columns:[],savedMetrics:[],selectedMetrics:[]};const R=(0,d.b)(I)},90422:(e,t,a)=>{a.d(t,{A:()=>s});var o=a(95483),n=a(71191),r=a(2511);const i=[...o.Wy].map((e=>o.nS[e].operation));class s{constructor(e){var t;this.expressionType=e.expressionType||r.A.Simple,this.expressionType===r.A.Simple?(this.subject=e.subject,this.operator=null==(t=e.operator)?void 0:t.toUpperCase(),this.operatorId=e.operatorId,this.comparator=e.comparator,[o.ux.IsTrue,o.ux.IsFalse].indexOf(e.operatorId)>=0&&(this.comparator=e.operatorId===o.ux.IsTrue),[o.ux.IsNull,o.ux.IsNotNull].indexOf(e.operatorId)>=0&&(this.comparator=null),this.clause=e.clause||r.v.Where,this.sqlExpression=null):this.expressionType===r.A.Sql&&(this.sqlExpression="string"==typeof e.sqlExpression?e.sqlExpression:(0,n.e)(e,{useSimple:!0}),this.clause=e.clause,e.operator&&i.indexOf(e.operator)>=0?(this.subject=e.subject,this.operator=e.operator,this.operatorId=e.operatorId):(this.subject=null,this.operator=null),this.comparator=null),this.isExtra=!!e.isExtra,this.isNew=!!e.isNew,this.datasourceWarning=!!e.datasourceWarning,this.filterOptionName=e.filterOptionName||`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}duplicateWith(e){return new s({...this,isNew:!1,...e})}equals(e){return e.clause===this.clause&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.operatorId===this.operatorId&&e.comparator===this.comparator&&e.subject===this.subject}isValid(){const e=[o.ux.IsNotNull,o.ux.IsNull].map((e=>o.nS[e].operation)),t=[o.ux.IsTrue,o.ux.IsFalse].map((e=>o.nS[e].operation));if(this.expressionType===r.A.Simple){if(e.indexOf(this.operator)>=0)return!(!this.operator||!this.subject);if(t.indexOf(this.operator)>=0)return!(!this.subject||null===this.comparator);if(this.operator&&this.subject&&this.clause)if(Array.isArray(this.comparator)){if(this.comparator.length>0)return!0}else if(null!==this.comparator)return!0}else if(this.expressionType===r.A.Sql)return!(!this.sqlExpression||!this.clause);return!1}getDefaultLabel(){const e=this.translateToSql();return e.length<43?e:`${e.substring(0,40)}...`}getTooltipTitle(){return this.translateToSql()}translateToSql(){return(0,n.e)(this)}}},21062:(e,t,a)=>{a.d(t,{A:()=>r});var o=a(5556),n=a.n(o);const r=n().shape({column_name:n().string.isRequired,type:n().string})},17093:(e,t,a)=>{a.d(t,{A:()=>s,t:()=>n});var o=a(95483);const n={SIMPLE:"SIMPLE",SQL:"SQL"};function r(e){if(e.sqlExpression&&o.Vw.test(e.sqlExpression)){const t=e.sqlExpression.indexOf(")"),a=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&a>0)return e.sqlExpression.substring(a+1,t)}return null}function i(e){if(e.sqlExpression&&o.Vw.test(e.sqlExpression)){const t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}class s{constructor(e){if(this.expressionType=e.expressionType||n.SIMPLE,this.expressionType===n.SIMPLE){const t=r(e);this.column=e.column||t&&{column_name:t},this.aggregate=e.aggregate||i(e),this.sqlExpression=null}else this.expressionType===n.SQL&&(this.sqlExpression=e.sqlExpression,this.column=null,this.aggregate=null);this.datasourceWarning=!!e.datasourceWarning,this.hasCustomLabel=!(!e.hasCustomLabel||!e.label),this.label=this.hasCustomLabel?e.label:this.getDefaultLabel(),this.optionName=e.optionName||`metric_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}getDefaultLabel(){return this.translateToSql({useVerboseName:!0})}translateToSql(e={useVerboseName:!1,transformCountDistinct:!1}){if(this.expressionType===n.SIMPLE){var t,a;const n=this.aggregate||"",r=e.useVerboseName&&null!=(t=this.column)&&t.verbose_name?`(${this.column.verbose_name})`:null!=(a=this.column)&&a.column_name?`(${this.column.column_name})`:"";return e.transformCountDistinct&&n===o.dq.COUNT_DISTINCT&&/^\(.*\)$/.test(r)?`COUNT(DISTINCT ${r.slice(1,-1)})`:n+r}return this.expressionType===n.SQL?this.sqlExpression:""}duplicateWith(e){return new s({...this,...e})}equals(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}isValid(){return this.expressionType===n.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===n.SQL&&!!this.sqlExpression}inferSqlExpressionAggregate(){return i(this)}inferSqlExpressionColumn(){return r(this)}}},84064:(e,t,a)=>{a.d(t,{A:()=>d}),a(96540);var o=a(5556),n=a.n(o),r=a(74792),i=a(8901),s=a(84080),l=a(17437);const c={option:n().oneOfType([r.A,n().shape({saved_metric_name:n().string.isRequired}),i.A]).isRequired};function d({option:e}){return e.saved_metric_name?(0,l.Y)(s.V,{column:{column_name:e.saved_metric_name,type:"expression"},showType:!0}):e.column_name?(0,l.Y)(s.V,{column:e,showType:!0}):e.label?(0,l.Y)(s.V,{column:{column_name:e.label,type:"expression"},showType:!0}):null}d.propTypes=c},8901:(e,t,a)=>{a.d(t,{A:()=>l});var o=a(5556),n=a.n(o),r=a(95483),i=a(74792),s=a(17093);const l=n().oneOfType([n().shape({expressionType:n().oneOf([s.t.SIMPLE]).isRequired,column:i.A.isRequired,aggregate:n().oneOf(Object.keys(r.dq)).isRequired,label:n().string.isRequired}),n().shape({expressionType:n().oneOf([s.t.SQL]).isRequired,sqlExpression:n().string.isRequired,label:n().string.isRequired})])},74792:(e,t,a)=>{a.d(t,{A:()=>r});var o=a(5556),n=a.n(o);const r=n().shape({column_name:n().string.isRequired,type:n().string})},32291:(e,t,a)=>{a.d(t,{A:()=>r});var o=a(5556),n=a.n(o);const r=n().shape({metric_name:n().string,verbose_name:n().string,expression:n().string})},28274:(e,t,a)=>{a.d(t,{A:()=>n});var o=a(67553);const n=["AND","AS","ASC","AVG","BY","CASE","COUNT","CREATE","CROSS","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","ELSE","END","FOREIGN","FROM","GRANT","GROUP","HAVING","IF","INNER","INSERT","JOIN","KEY","LEFT","LIMIT","MAX","MIN","NATURAL","NOT","NULL","OFFSET","ON","OR","ORDER","OUTER","PRIMARY","REFERENCES","RIGHT","SELECT","SUM","TABLE","THEN","TYPE","UNION","UPDATE","WHEN","WHERE"].concat(["BIGINT","BINARY","BIT","CHAR","DATE","DECIMAL","DOUBLE","FLOAT","INT","INTEGER","MONEY","NUMBER","NUMERIC","REAL","SET","TEXT","TIMESTAMP","VARCHAR"]).map((e=>({meta:"sql",name:e,score:o.lI,value:e})))},25946:(e,t,a)=>{a.d(t,{A:()=>l});var o=a(97032),n=a(17437),r=(a(96540),a(94535)),i=a(96453),s=a(12249);function l(e){const{type:t="info",description:a,showIcon:l=!0,closable:c=!0,roomBelow:d=!1,children:u}=e,p=(0,i.DP)(),{colors:h,typography:m,gridUnit:g}=p,{alert:v,error:b,info:f,success:y}=h;let x=f,A=s.A.InfoSolid;return"error"===t?(x=b,A=s.A.ErrorSolid):"warning"===t?(x=v,A=s.A.AlertSolid):"success"===t&&(x=y,A=s.A.CircleCheckSolid),(0,n.Y)(r.default,(0,o.A)({role:"alert",showIcon:l,icon:(0,n.Y)(A,{"aria-label":`${t} icon`}),closeText:c&&(0,n.Y)(s.A.XSmall,{"aria-label":"close icon"}),css:(0,n.AH)({marginBottom:d?4*g:0,padding:`${2*g}px ${3*g}px`,alignItems:"flex-start",border:0,backgroundColor:x.light2,"& .ant-alert-icon":{marginRight:2*g},"& .ant-alert-message":{color:x.dark2,fontSize:m.sizes.m,fontWeight:a?m.weights.bold:m.weights.normal},"& .ant-alert-description":{color:x.dark2,fontSize:m.sizes.m}},"","")},e),u)}},67429:(e,t,a)=>{a.d(t,{C:()=>i}),a(96540);var o=a(17437),n=a(12249),r=a(19129);const i=({title:e,color:t})=>(0,o.Y)(r.m,{title:e,placement:"top"},(0,o.Y)(n.A.InfoCircleOutlined,{"data-test":"tooltip-trigger",css:e=>o.AH`
        color: ${t||e.colors.text.label};
        margin-left: ${2*e.gridUnit}px;
        &.anticon {
          font-size: unset;
          .anticon {
            line-height: unset;
            vertical-align: unset;
          }
        }
      `}))},44230:(e,t,a)=>{a.d(t,{k:()=>le});var o=a(97032),n=a(62193),r=a.n(n),i=a(96540),s=a(95579),l=a(17437),c=a(58642),d=a(90017),u=a(80145),p=a(58863),h=a(46302),m=a(6749),g=a(56347),v=a(96453),b=a(85861),f=a(46920),y=a(61225),x=a(94229),A=a(84666),C=a(87903),S=a(62952),T=a(98250),Y=a(17444),_=a(27023);const w=function({value:e}){return(0,l.Y)("span",null,e?_.bU:_.y2)},F=function(){return(0,l.Y)("span",{css:e=>l.AH`
        color: ${e.colors.grayscale.light1};
      `},_.bV)};var E=a(85170),D=a(7349);const M=function({format:e=E.A.DATABASE_DATETIME,value:t}){return t?(0,l.Y)("span",null,(0,D.mo)(e).format(t)):(0,l.Y)(F,null)};var $=a(87196),I=a(2514),R=a(51003),k=a(78697),O=a(15595),N=a(12249),q=a(50127);const U=function(e){const{headerTitle:t,groupTitle:a,groupOptions:o,value:n,onChange:r}=e,s=(0,v.DP)(),[c,d]=(0,i.useState)(!1);return(0,l.Y)("div",{css:l.AH`
        display: flex;
        align-items: center;
      `},(0,l.Y)(q.A,{trigger:"click",visible:c,content:(0,l.Y)("div",null,(0,l.Y)("div",{css:l.AH`
                font-weight: ${s.typography.weights.bold};
                margin-bottom: ${s.gridUnit}px;
              `},a),(0,l.Y)(k.s.Group,{value:n,onChange:e=>{r(e.target.value),d(!1)}},(0,l.Y)(O.$x,{direction:"vertical"},o.map((e=>(0,l.Y)(k.s,{key:e.value,value:e.value},e.label)))))),placement:"bottomLeft",arrowPointAtCenter:!0},(0,l.Y)(N.A.SettingOutlined,{iconSize:"m",iconColor:s.colors.grayscale.light1,css:l.AH`
            margin-top: 3px; // we need exactly 3px to align the icon
            margin-right: ${s.gridUnit}px;
          `,onClick:()=>d(!0)})),t)};var L=a(86274),j=a(55976),P=a(66270),H=a(70700),z=a(26761);function V({filters:e,setFilters:t,totalCount:a,loading:o,onReload:n}){const r=(0,v.DP)(),c=(0,i.useMemo)((()=>Object.assign({},...e.map((e=>({[(0,H.q0)(e.col)?e.col.label:e.col]:e}))))),[e]),d=(0,i.useCallback)((e=>{const a={...c};delete a[e],t([...Object.values(a)])}),[c,t]),u=(0,i.useMemo)((()=>Object.entries(c).map((([e,{val:t,formattedVal:a}])=>({colName:e,val:null!=a?a:t}))).sort(((e,t)=>e.colName.localeCompare(t.colName)))),[c]);return(0,l.Y)("div",{css:l.AH`
        display: flex;
        justify-content: space-between;
        padding: ${r.gridUnit/2}px 0;
        margin-bottom: ${2*r.gridUnit}px;
      `},(0,l.Y)("div",{css:l.AH`
          display: flex;
          flex-wrap: wrap;
          margin-bottom: -${4*r.gridUnit}px;
        `},u.map((({colName:e,val:t})=>(0,l.Y)(P.A,{closable:!0,onClose:d.bind(null,e),key:e,css:l.AH`
              height: ${6*r.gridUnit}px;
              display: flex;
              align-items: center;
              padding: ${r.gridUnit/2}px ${2*r.gridUnit}px;
              margin-right: ${4*r.gridUnit}px;
              margin-bottom: ${4*r.gridUnit}px;
              line-height: 1.2;
            `,"data-test":"filter-col"},(0,l.Y)("span",{css:l.AH`
                margin-right: ${r.gridUnit}px;
              `},e),(0,l.Y)("strong",{"data-test":"filter-val"},t))))),(0,l.Y)("div",{css:l.AH`
          display: flex;
          align-items: center;
          height: min-content;
        `},(0,l.Y)(z.A,{loading:o&&!a,rowcount:a}),(0,l.Y)(N.A.ReloadOutlined,{iconColor:r.colors.grayscale.light1,iconSize:"l","aria-label":(0,s.t)("Reload"),role:"button",onClick:n})))}var W=a(90179),B=a.n(W),G=a(26632);const Q=50;var X,J={name:"82a6rk",styles:"flex:1"};function K({children:e}){const{ref:t,height:a}=(0,T.uZ)();return(0,l.Y)("div",{ref:t,css:J},i.cloneElement(e,{height:a}))}function Z({formData:e,initialFilters:t}){const a=(0,v.DP)(),[o,n]=(0,i.useState)(0),r=(0,i.useRef)(o),[c,d]=(0,i.useState)(t),[u,p]=(0,i.useState)(!1),[h,m]=(0,i.useState)(""),[g,b]=(0,i.useState)(new Map),[f,x]=(0,i.useState)({}),A=(0,y.d4)((e=>e.common.conf.SAMPLES_ROW_LIMIT)),[T,_]=(0,i.useMemo)((()=>e.datasource.split("__")),[e.datasource]),{metadataBar:E,status:D}=(0,j.M)({datasetId:T}),k=(0,i.useMemo)((()=>{const e=g.get(o);return e?(r.current=o,e):g.get(r.current)}),[o,g]),O=(0,i.useMemo)((()=>(null==k?void 0:k.colNames.map(((e,t)=>({key:e,dataIndex:e,title:(null==k?void 0:k.colTypes[t])===C.s.Temporal?(0,l.Y)(U,{headerTitle:e,groupTitle:(0,s.t)("Formatting"),groupOptions:[{label:(0,s.t)("Original value"),value:X.Original},{label:(0,s.t)("Formatted value"),value:X.Formatted}],value:f[e]===X.Original?X.Original:X.Formatted,onChange:t=>x((a=>({...a,[e]:t})))}):e,render:a=>!0===a||!1===a?(0,l.Y)(w,{value:a}):null===a?(0,l.Y)(F,null):(null==k?void 0:k.colTypes[t])===C.s.Temporal&&f[e]!==X.Original&&("number"==typeof a||a instanceof Date)?(0,l.Y)(M,{value:a}):String(a),width:150}))))||[]),[null==k?void 0:k.colNames,null==k?void 0:k.colTypes,f]),N=(0,i.useMemo)((()=>(null==k?void 0:k.data.map(((e,t)=>null==k?void 0:k.colNames.reduce(((t,a)=>({...t,[a]:e[a]})),{key:t}))))||[]),[null==k?void 0:k.colNames,null==k?void 0:k.data]),q=(0,i.useCallback)((()=>{m(""),b(new Map),n(0)}),[]);(0,i.useEffect)((()=>{m(""),b(new Map),n(0)}),[c]),(0,i.useEffect)((()=>{if(g.has(o)&&[...g.keys()].at(-1)!==o){const e=new Map(g);e.delete(o),b(e.set(o,g.get(o)))}}),[o,g]),(0,i.useEffect)((()=>{if(!h&&!u&&!g.has(o)){var t;p(!0);const a=null!=(t=function(e,t){if(!e)return;const a=(0,G.A)(e),o=B()(a.extras,"having"),n=[...(0,S.A)(a.filters),...(0,S.A)(t).map((e=>B()(e,"formattedVal")))];return{granularity:a.granularity,time_range:a.time_range,filters:n,extras:o}}(e,c))?t:{},n=Math.ceil(A/Q);(0,I.getDatasourceSamples)(_,T,!1,a,Q,o+1).then((e=>{b(new Map([...[...g.entries()].slice(1-n),[o,{total:e.total_count,data:e.data,colNames:(0,S.A)(e.colnames),colTypes:(0,S.A)(e.coltypes)}]])),m("")})).catch((e=>{m(`${e.name}: ${e.message}`)})).finally((()=>{p(!1)}))}}),[A,T,_,c,e,u,o,h,g]);const P=!h&&!g.size||D===L.bk.Loading;let H=null;if(h)H=(0,l.Y)("pre",{css:l.AH`
          margin-top: ${4*a.gridUnit}px;
        `},h);else if(P)H=(0,l.Y)(Y.A,null);else if(0===(null==k?void 0:k.total)){const e=(0,s.t)("No rows were returned for this dataset");H=(0,l.Y)($.uq,{image:"document.svg",title:e})}else H=(0,l.Y)(K,null,(0,l.Y)(R.Ay,{data:N,columns:O,size:R.QS.Small,defaultPageSize:Q,recordCount:null==k?void 0:k.total,usePagination:!0,loading:u,onChange:e=>n(e.current?e.current-1:0),resizable:!0,virtualize:!0,allowHTML:!0}));return(0,l.Y)(i.Fragment,null,!P&&E,!P&&(0,l.Y)(V,{filters:c,setFilters:d,totalCount:null==k?void 0:k.total,loading:u,onReload:q}),H)}!function(e){e[e.Original=0]="Original",e[e.Formatted=1]="Formatted"}(X||(X={}));const ee=({canExplore:e,closeModal:t,exploreChart:a})=>{const o=(0,v.DP)();return(0,l.Y)(i.Fragment,null,(0,l.Y)(f.A,{buttonStyle:"secondary",buttonSize:"small",onClick:a,disabled:!e,tooltip:e?void 0:(0,s.t)("You do not have sufficient permissions to edit the chart")},(0,s.t)("Edit chart")),(0,l.Y)(f.A,{buttonStyle:"primary",buttonSize:"small",onClick:t,"data-test":"close-drilltodetail-modal",css:l.AH`
          margin-left: ${2*o.gridUnit}px;
        `},(0,s.t)("Close")))};function te({chartId:e,formData:t,initialFilters:a,showModal:o,onHideModal:n}){const r=(0,v.DP)(),c=(0,g.W6)(),d=(0,i.useContext)(x.DashboardPageIdContext),{slice_name:u}=(0,y.d4)((t=>t.sliceEntities.slices[e])),p=(0,y.d4)((e=>{var t;return(0,A.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),h=(0,i.useMemo)((()=>`/explore/?dashboard_page_id=${d}&slice_id=${e}`),[e,d]),m=(0,i.useCallback)((()=>{c.push(h)}),[h,c]);return(0,l.Y)(b.A,{show:o,onHide:null!=n?n:()=>null,css:l.AH`
        .ant-modal-body {
          display: flex;
          flex-direction: column;
        }
      `,title:(0,s.t)("Drill to detail: %s",u),footer:(0,l.Y)(ee,{exploreChart:m,canExplore:p}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*r.gridUnit,minWidth:128*r.gridUnit,defaultSize:{width:"auto",height:"75vh"}},draggable:!0,destroyOnClose:!0,maskClosable:!1},(0,l.Y)(Z,{formData:t,initialFilters:a}))}var ae=a(83537),oe=a(67429),ne=a(28543);const re=(0,s.t)("Drill to detail by"),ie=({children:e,...t})=>(0,l.Y)(m.W.Item,(0,o.A)({disabled:!0},t),(0,l.Y)("div",{css:l.AH`
        white-space: normal;
        max-width: 160px;
      `},e)),se=(0,d.A)((({children:e,stripHTML:t=!1})=>{const a=t&&"string"==typeof e?(0,c.zF)(e):e;return(0,l.Y)("span",null,a)}))`
  ${({theme:e})=>`\n     font-weight: ${e.typography.weights.bold};\n     color: ${e.colors.primary.base};\n   `}
`,le=({chartId:e,formData:t,filters:a=[],isContextMenu:n=!1,contextMenuY:c=0,onSelection:d=(()=>null),onClick:g=(()=>null),submenuIndex:v=0,...b})=>{const[f,y]=(0,i.useState)([]),[x,A]=(0,i.useState)(!1),C=(0,i.useCallback)(((e,t)=>{g(t),d(),y(e),A(!0)}),[g,d]),S=(0,i.useCallback)((()=>{A(!1)}),[]),T=(0,i.useMemo)((()=>{var e;return null==(e=(0,u.A)().get(t.viz_type))?void 0:e.behaviors.find((e=>e===p.nS.DrillToDetail))}),[t.viz_type]),Y=(0,i.useMemo)((()=>{const{metrics:e}=(0,h.A)(t);return r()(e)}),[t]);let _,w;_=T&&Y?(0,l.Y)(ie,(0,o.A)({},b,{key:"drill-detail-no-aggregations"}),(0,s.t)("Drill to detail"),(0,l.Y)(oe.C,{title:(0,s.t)("Drill to detail is disabled because this chart does not group data by dimension value.")})):(0,l.Y)(m.W.Item,(0,o.A)({},b,{key:"drill-detail-no-filters",onClick:C.bind(null,[])}),(0,s.t)("Drill to detail")),T||(w=(0,l.Y)(ie,(0,o.A)({},b,{key:"drill-detail-by-chart-not-supported"}),re,(0,l.Y)(oe.C,{title:(0,s.t)("Drill to detail by value is not yet supported for this chart type.")}))),T&&Y&&(w=(0,l.Y)(ie,(0,o.A)({},b,{key:"drill-detail-by-no-aggregations"}),re));const F=(0,i.useMemo)((()=>(0,ae.Gs)(c,a.length>1?a.length+1:a.length,v)),[c,a.length,v]);return T&&!Y&&null!=a&&a.length&&(w=(0,l.Y)(m.W.SubMenu,(0,o.A)({},b,{popupOffset:[0,F],popupClassName:"chart-context-submenu",title:re}),(0,l.Y)("div",{"data-test":"drill-to-detail-by-submenu"},a.map(((e,t)=>(0,l.Y)(ne.o,(0,o.A)({},b,{tooltipText:`${re} ${e.formattedVal}`,key:`drill-detail-filter-${t}`,onClick:C.bind(null,[e])}),`${re} `,(0,l.Y)(se,{stripHTML:!0},e.formattedVal)))),a.length>1&&(0,l.Y)(m.W.Item,(0,o.A)({},b,{key:"drill-detail-filter-all",onClick:C.bind(null,a)}),(0,l.Y)("div",null,`${re} `,(0,l.Y)(se,{stripHTML:!1},(0,s.t)("all"))))))),!T||Y||null!=a&&a.length||(w=(0,l.Y)(ie,(0,o.A)({},b,{key:"drill-detail-by-select-aggregation"}),re,(0,l.Y)(oe.C,{title:(0,s.t)("Right-click on a dimension value to drill to detail by that value.")}))),(0,l.Y)(i.Fragment,null,_,n&&w,(0,l.Y)(te,{chartId:e,formData:t,initialFilters:f,showModal:x,onHideModal:S}))}},28543:(e,t,a)=>{a.d(t,{o:()=>l});var o=a(97032),n=(a(96540),a(37827)),r=a(17437),i=a(6749),s=a(19129);const l=({tooltipText:e,children:t,...a})=>{const[l,c]=(0,n.A)();return(0,r.Y)(i.W.Item,(0,o.A)({css:r.AH`
        display: flex;
      `},a),(0,r.Y)(s.m,{title:c?e:null},(0,r.Y)("div",{ref:l,css:r.AH`
            max-width: 100%;
            ${n.P};
          `},t)))}},83537:(e,t,a)=>{a.d(t,{Gs:()=>n,x4:()=>o});const o=(e,t,a=Number.MAX_SAFE_INTEGER,o=0)=>{const n=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),r=Math.min(32*t,a)+32+o;return n-e<r?n-r:e},n=(e,t,a=0,n=Number.MAX_SAFE_INTEGER,r=0)=>{const i=e+4+32*a+4;return o(i,t,n,r)-i}},50068:(e,t,a)=>{a.d(t,{Dj:()=>s.Dj,cp:()=>s.cp,Ay:()=>i}),a(96540);var o=a(90017),n=a(17437);const r=o.A.span`
  &,
  & svg {
    vertical-align: top;
  }
`;function i({checked:e,onChange:t,style:a,className:o}){return(0,n.Y)(r,{style:a,onClick:()=>{t(!e)},role:"checkbox",tabIndex:0,"aria-checked":e,"aria-label":"Checkbox",className:o||""},e?(0,n.Y)(s.Dj,null):(0,n.Y)(s.cp,null))}var s=a(75264)},93103:(e,t,a)=>{a.d(t,{R2:()=>p,ms:()=>u});var o=a(97032),n=(a(96540),a(15595)),r=a(90017),i=a(12249),s=a(17437);const l=r.A.div`
  width: ${({theme:e})=>.75*e.gridUnit}px;
  height: ${({theme:e})=>.75*e.gridUnit}px;
  border-radius: 50%;
  background-color: ${({theme:e})=>e.colors.grayscale.light1};

  font-weight: ${({theme:e})=>e.typography.weights.normal};
  display: inline-flex;
  position: relative;

  &:hover {
    background-color: ${({theme:e})=>e.colors.primary.base};

    &::before,
    &::after {
      background-color: ${({theme:e})=>e.colors.primary.base};
    }
  }

  &::before,
  &::after {
    position: absolute;
    content: ' ';
    width: ${({theme:e})=>.75*e.gridUnit}px;
    height: ${({theme:e})=>.75*e.gridUnit}px;
    border-radius: 50%;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }

  &::before {
    top: ${({theme:e})=>e.gridUnit}px;
  }

  &::after {
    bottom: ${({theme:e})=>e.gridUnit}px;
  }
`,c=r.A.div`
  display: flex;
  align-items: center;
  padding: ${({theme:e})=>2*e.gridUnit}px;
  padding-left: ${({theme:e})=>e.gridUnit}px;
`;var d;!function(e){e.Vertical="vertical",e.Horizontal="horizontal"}(d||(d={}));const u=({overlay:e,iconOrientation:t=d.Vertical,...a})=>(0,s.Y)(n.rM,(0,o.A)({overlay:e},a),(0,s.Y)(c,{"data-test":"dropdown-trigger"},((e=d.Vertical)=>e===d.Horizontal?(0,s.Y)(i.A.MoreHoriz,{iconSize:"xl"}):(0,s.Y)(l,null))(t))),p=e=>(0,s.Y)(n.rM,(0,o.A)({overlayStyle:e.overlayStyle},e))},25062:(e,t,a)=>{a.d(t,{J8:()=>m,Kg:()=>f,Pz:()=>y,pY:()=>h,px:()=>g,tg:()=>p});var o=a(96627),n=a(58863),r=a(27366),i=a(95579),s=a(88488),l=a(49588),c=a(81151),d=a(38708);const u=()=>{var e,t;const a=(0,d.A)();return(null==a||null==(e=a.common)||null==(t=e.conf)?void 0:t.NATIVE_FILTER_DEFAULT_ROW_LIMIT)||1e3},p=({datasetId:e,dependencies:t={},groupby:a,defaultDataMask:o,controlValues:n,filterType:r,sortMetric:i,adhoc_filters:l,time_range:c,granularity_sqla:d,type:p,dashboardId:h,id:m})=>{var g;const v={};return e&&(v.datasource=`${e}__table`),a&&(v.groupby=[a]),i&&(v.sortMetric=i),{...n,...v,adhoc_filters:null!=l?l:[],extra_filters:[],extra_form_data:t,granularity_sqla:d,metrics:["count"],row_limit:u(),showSearch:!0,defaultValue:null==o||null==(g=o.filterState)?void 0:g.value,time_range:c,url_params:(0,s.A)("regular"),inView:!0,viz_type:r,type:p,dashboardId:h,native_filter_id:m}};function h(e={},t={}){const a={};return o.t1.forEach((o=>{const n=[...e[o]||[],...t[o]||[]];n.length&&(a[o]=n)})),o.zk.forEach((o=>{const n=e[o];void 0!==n&&(a[o]=n);const r=t[o];void 0!==r&&(a[o]=r)})),a}function m(e,t){let a={};return t.forEach((t=>{var o,n;a=h(a,null!=(o=null==(n=e[t])?void 0:n.extraFormData)?o:{})})),a}function g(e){return!e.includes(n.nS.NativeFilter)||(0,r.G7)(r.TO.DashboardCrossFilters)&&e.includes(n.nS.InteractiveChart)}const v=(e,t)=>{var a;return(null==e||null==(a=e[t])?void 0:a.type)===l.B8},b=(e,t,a,o,n,r)=>{var i,s,c,d,u,p;r.has(a)||(r.add(a),(null==e||null==(i=e[a])?void 0:i.type)===l.oT&&t.includes(null==(s=e[a])||null==(c=s.meta)?void 0:c.chartId)&&o.forEach(n.add,n),0===(null==e||null==(d=e[a])||null==(u=d.children)?void 0:u.length)||v(e,a)&&n.has(a)||null==(p=e[a])||p.children.forEach((a=>b(e,t,a,v(e,a)?[...o,a]:o,n,r))))},f=(e,t)=>{const a=e[c.wv].children[0],o=a!==c.mK,n=new Set,r=new Set;var i,s;return o?null==(i=e[a])||null==(s=i.children)||s.forEach((a=>b(e,t,a,[a],n,r))):Object.values(e).filter((e=>(null==e?void 0:e.type)===l.B8)).forEach((a=>b(e,t,a.id,[a.id],n,r))),n},y=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,i.t)("Unknown value")},76295:(e,t,a)=>{a.d(t,{A:()=>c});var o=a(25062),n=a(35839);function r(e){return Object.entries(e).map((([e,t])=>({col:e,op:Array.isArray(t)?"IN":"==",val:t}))).filter((e=>null!==e.val))}var i=a(92008);const s={},l={};function c({chart:e,filters:t,nativeFilters:a,chartConfiguration:c,colorScheme:d,colorNamespace:u,sliceId:p,dataMask:h,extraControls:m,labelColors:g,sharedLabelColors:v,allSliceIds:b}){const f=l[p];if(s[p]===t&&(0,n.r$)(null==f?void 0:f.color_scheme,d,{ignoreUndefined:!0})&&(0,n.r$)(null==f?void 0:f.color_namespace,u,{ignoreUndefined:!0})&&(0,n.r$)(null==f?void 0:f.label_colors,g,{ignoreUndefined:!0})&&(0,n.r$)(null==f?void 0:f.shared_label_colors,v,{ignoreUndefined:!0})&&f&&(0,n.r$)(null==f?void 0:f.dataMask,h,{ignoreUndefined:!0})&&(0,n.r$)(null==f?void 0:f.extraControls,m,{ignoreUndefined:!0}))return f;let y={};const x=(0,i.R)({chartConfiguration:c,dataMask:h,nativeFilters:a,allSliceIds:b}),A=Object.entries(x).filter((([,{scope:t}])=>t.includes(e.id))).map((([e])=>e));A.length&&(y={extra_form_data:(0,o.J8)(h,A)});const C={...e.form_data,label_colors:g,shared_label_colors:v,...d&&{color_scheme:d},extra_filters:r(t),...y,...m};return s[p]=t,l[p]={...C,dataMask:h,extraControls:m},C}},39091:(e,t,a)=>{a.d(t,{$r:()=>I,TN:()=>_,XS:()=>k,ZY:()=>w,i8:()=>Y});var o=a(17437),n=a(38221),r=a.n(n),i=a(96540),s=a(90017),l=a(96453),c=a(95579),d=a(7349),u=a(85170),p=a(87903),h=a(58642),m=a(15595),g=a(90868),v=a(27023),b=a(78697),f=a(12249),y=a(46920),x=a(50127),A=a(15151),C=a(55594),S=a(86832);const T=(0,s.A)("span")`
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,Y=(0,s.A)(y.A)`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;

  // needed to override button's first-of-type margin: 0
  && {
    margin: 0 ${({theme:e})=>2*e.gridUnit}px;
  }

  i {
    padding: 0 ${({theme:e})=>e.gridUnit}px;
  }
`,_=({data:e,columns:t})=>{const a=(0,l.DP)();return(0,o.Y)(C.A,{text:e&&t?(0,A.L)(e,t):"",wrapped:!1,copyNode:(0,o.Y)(f.A.CopyOutlined,{iconColor:a.colors.grayscale.base,iconSize:"l","aria-label":(0,c.t)("Copy"),role:"button",css:o.AH`
            &.anticon > * {
              line-height: 0;
            }
          `})})},w=({onChangeHandler:e})=>{const t=(0,l.DP)(),a=r()(e,v.Qs);return(0,o.Y)(g.pd,{prefix:(0,o.Y)(f.A.Search,{iconColor:t.colors.grayscale.base}),placeholder:(0,c.t)("Search"),onChange:e=>{const t=e.target.value;a(t)},css:o.AH`
        width: 200px;
        margin-right: ${2*t.gridUnit}px;
      `})};var F;!function(e){e.Formatted="formatted",e.Original="original"}(F||(F={}));const E=({onChange:e,value:t})=>(0,o.Y)(b.s.Group,{value:t,onChange:e},(0,o.Y)(m.$x,{direction:"vertical"},(0,o.Y)(b.s,{value:F.Formatted},(0,c.t)("Formatted date")),(0,o.Y)(b.s,{value:F.Original},(0,c.t)("Original value")))),D=s.A.div`
  display: flex;
  flex-direction: column;

  padding: ${({theme:e})=>4*e.gridUnit+"px"};
`,M=s.A.span`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.base};
  margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  text-transform: uppercase;
`,$=({columnName:e,onTimeColumnChange:t,datasourceId:a,isOriginalTimeColumn:n})=>{const r=(0,l.DP)(),s=a=>{t(e,a.target.value)},d=(0,i.useMemo)((()=>a?(0,o.Y)(D,{onClick:e=>e.stopPropagation()},(0,o.Y)(o.mL,{styles:o.AH`
              .column-formatting-popover .ant-popover-inner-content {
                padding: 0;
              }
            `}),(0,o.Y)(M,null,(0,c.t)("Column Formatting")),(0,o.Y)(E,{onChange:s,value:n?F.Original:F.Formatted})):null),[a,n]);return a?(0,o.Y)("span",null,(0,o.Y)(x.A,{overlayClassName:"column-formatting-popover",trigger:"click",content:d,placement:"bottomLeft",arrowPointAtCenter:!0},(0,o.Y)(f.A.SettingOutlined,{iconSize:"m",iconColor:r.colors.grayscale.light1,css:(0,o.AH)({marginRight:`${r.gridUnit}px`},"",""),onClick:e=>e.stopPropagation()})),e):(0,o.Y)("span",null,e)},I=(e,t)=>{const a=(0,i.useMemo)((()=>{var e;return null!=(e=null==t?void 0:t.map((e=>Object.values(e).map((e=>e?e.toString().toLowerCase():(0,c.t)("N/A"))))))?e:[]}),[t]);return(0,i.useMemo)((()=>null!=t&&t.length?t.filter(((t,o)=>a[o].some((t=>null==t?void 0:t.includes(e.toLowerCase()))))):[]),[t,e,a])},R=(0,d.mo)(u.A.DATABASE_DATETIME),k=(e,t,a,n,r,s,l)=>{const[c,d]=(0,i.useState)((0,S.p)(n)),u=(e,t)=>{if(n)if(t!==F.Original||c.includes(e)){if(t===F.Formatted&&c.includes(e)){const t=(0,S.p)(n);t.splice(t.indexOf(e),1),(0,S.J)(n,t),d(t)}}else{const t=(0,S.p)(n);t.push(e),(0,S.J)(n,t),d(t)}};return(0,i.useEffect)((()=>{r&&d((0,S.p)(n))}),[n,r]),(0,i.useMemo)((()=>e&&null!=a&&a.length?e.filter((e=>Object.keys(a[0]).includes(e))).map(((e,r)=>{const i=null==t?void 0:t[r],d=a[0][e],m=i===p.s.Temporal?c.indexOf(e):-1,g=c.includes(e);return{id:e||r,accessor:t=>t[e],Header:i===p.s.Temporal&&"string"!=typeof d?(0,o.Y)($,{columnName:e,datasourceId:n,onTimeColumnChange:u,isOriginalTimeColumn:g}):e,Cell:({value:e})=>!0===e?v.bU:!1===e?v.y2:null===e?(0,o.Y)(T,null,v.bV):i===p.s.Temporal&&-1===m&&"number"==typeof e?R(e):"string"==typeof e&&l?(0,h.nn)(e):String(e),...null==s?void 0:s[e]}})):[]),[e,a,t,n,s,c])}},86832:(e,t,a)=>{a.d(t,{J:()=>i,p:()=>r});var o=a(62952),n=a(62221);const r=e=>{const t=(0,n.Gq)(n.Hh.ExploreDataTableOriginalFormattedTimeColumns,{});return void 0===e?[]:(0,o.A)(t[e])},i=(e,t)=>{const a=(0,n.Gq)(n.Hh.ExploreDataTableOriginalFormattedTimeColumns,{});(0,n.SO)(n.Hh.ExploreDataTableOriginalFormattedTimeColumns,{...a,[e]:t})}},80493:(e,t,a)=>{a.d(t,{x:()=>m,y:()=>h});var o=a(65611),n=a.n(o),r=a(96540),i=a(90017),s=a(87903),l=a(17437),c=a(39091),d=a(15151),u=a(86832),p=a(26761);const h=i.A.div`
  ${({theme:e})=>`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: ${2*e.gridUnit}px;\n\n    span {\n      flex-shrink: 0;\n    }\n  `}
`,m=({data:e,datasourceId:t,onInputChange:a,columnNames:o,columnTypes:i,rowcount:m,isLoading:g})=>{const v=(0,u.p)(t),b=n()(o,i).filter((([e,t])=>t===s.s.Temporal&&e&&!v.includes(e))).map((([e])=>e)),f=(0,r.useMemo)((()=>(0,d.bE)(e,b)),[e,b]);return(0,l.Y)(h,null,(0,l.Y)(c.ZY,{onChangeHandler:a}),(0,l.Y)("div",{css:l.AH`
          display: flex;
          align-items: center;
        `},(0,l.Y)(p.A,{rowcount:m,loading:g}),(0,l.Y)(c.TN,{data:f,columns:o})))}},8877:(e,t,a)=>{a.d(t,{U:()=>c});var o=a(96540),n=a(95579),r=a(50217),i=a(39091),s=a(80493),l=a(17437);const c=({data:e,colnames:t,coltypes:a,rowcount:c,datasourceId:d,dataSize:u=50,isVisible:p})=>{const[h,m]=(0,o.useState)(""),g=(0,i.XS)(t,a,e,d,p,{},!0),v=(0,i.$r)(h,e);return(0,l.Y)(o.Fragment,null,(0,l.Y)(s.x,{data:v,columnNames:t,columnTypes:a,rowcount:c,datasourceId:d,onInputChange:e=>m(e),isLoading:!1}),(0,l.Y)(r.A,{columns:g,data:v,pageSize:u,noDataText:(0,n.t)("No results"),emptyWrapperType:r.V.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,small:!0}))}},8786:(e,t,a)=>{a.d(t,{_h:()=>$,ih:()=>Y});var o,n=a(96540),r=a(90017),i=a(96453),s=a(27366),l=a(95579),c=a(12249),d=a(48327),u=a(62221);!function(e){e.Results="results",e.Samples="samples"}(o||(o={}));var p=a(80145),h=a(62952),m=a(17444),g=a(87196),v=a(2514),b=a(94146),f=a(8877),y=a(80493),x=a(17437);const A=r.A.pre`
  margin-top: ${({theme:e})=>4*e.gridUnit+"px"};
`,C=new WeakMap,S=({isRequest:e,queryFormData:t,queryForce:a,ownState:o,errorMessage:r,actions:i,isVisible:s,dataSize:c=50})=>{var d;const u=(0,p.A)().get((null==t?void 0:t.viz_type)||(null==t?void 0:t.vizType)),[S,T]=(0,n.useState)([]),[Y,_]=(0,n.useState)(!0),[w,F]=(0,n.useState)(""),E=null!=(d=null==u?void 0:u.queryObjectCount)?d:1;if((0,n.useEffect)((()=>{r||(e&&C.has(t)&&(T((0,h.A)(C.get(t))),F(""),a&&i&&i.setForceQuery(!1),_(!1)),e&&!C.has(t)&&(_(!0),(0,v.getChartDataRequest)({formData:t,force:a,resultFormat:"json",resultType:"results",ownState:o}).then((({json:e})=>{T((0,h.A)(e.result)),F(""),C.set(t,e.result),a&&i&&i.setForceQuery(!1)})).catch((e=>{(0,b.h4)(e).then((({error:e,message:t})=>{F(e||t||(0,l.t)("Sorry, an error occurred"))}))})).finally((()=>{_(!1)}))))}),[t,e]),(0,n.useEffect)((()=>{r&&_(!1)}),[r]),Y)return Array(E).fill((0,x.Y)(m.A,null));if(r){const e=(0,l.t)("Run a query to display results");return Array(E).fill((0,x.Y)(g.uq,{image:"document.svg",title:e}))}if(w){const e=(0,x.Y)(n.Fragment,null,(0,x.Y)(y.x,{data:[],columnNames:[],columnTypes:[],rowcount:0,datasourceId:t.datasource,onInputChange:()=>{},isLoading:!1}),(0,x.Y)(A,null,w));return Array(E).fill(e)}if(0===S.length){const e=(0,l.t)("No results were returned for this query");return Array(E).fill((0,x.Y)(g.uq,{image:"document.svg",title:e}))}return S.slice(0,E).map(((e,a)=>(0,x.Y)(f.U,{data:e.data,colnames:e.colnames,coltypes:e.coltypes,rowcount:e.rowcount,dataSize:c,datasourceId:t.datasource,key:a,isVisible:s})))},T=r.A.div`
  display: flex;
  flex-direction: column;
  height: 100%;

  .ant-tabs {
    height: 100%;
  }

  .ant-tabs-content {
    height: 100%;
  }

  .ant-tabs-tabpane {
    display: flex;
    flex-direction: column;
  }

  .table-condensed {
    overflow: auto;
  }
`,Y=({isRequest:e,queryFormData:t,queryForce:a,ownState:n,errorMessage:r,actions:i,isVisible:s,dataSize:c=50})=>{const u=S({errorMessage:r,queryFormData:t,queryForce:a,ownState:n,isRequest:e,actions:i,dataSize:c,isVisible:s});if(1===u.length)return(0,x.Y)(T,null,u[0]);const p=u.map(((e,t)=>0===t?(0,x.Y)(d.Ay.TabPane,{tab:(0,l.t)("Results"),key:o.Results},e):(0,x.Y)(d.Ay.TabPane,{tab:(0,l.t)("Results %s",t+1),key:`${o.Results} ${t+1}`},e)));return(0,x.Y)(T,null,(0,x.Y)(d.Ay,{fullWidth:!1},p))};var _=a(50217),w=a(39091);const F=r.A.pre`
  margin-top: ${({theme:e})=>4*e.gridUnit+"px"};
`,E=new WeakSet,D=({isRequest:e,datasource:t,queryForce:a,actions:o,dataSize:r=50,isVisible:i})=>{const[s,c]=(0,n.useState)(""),[d,u]=(0,n.useState)([]),[p,b]=(0,n.useState)([]),[f,A]=(0,n.useState)([]),[C,S]=(0,n.useState)(!1),[T,Y]=(0,n.useState)(0),[D,M]=(0,n.useState)(""),$=(0,n.useMemo)((()=>`${t.id}__${t.type}`),[t]);(0,n.useEffect)((()=>{e&&a&&E.delete(t),e&&!E.has(t)&&(S(!0),(0,v.getDatasourceSamples)(t.type,t.id,a,{}).then((e=>{u((0,h.A)(e.data)),b((0,h.A)(e.colnames)),A((0,h.A)(e.coltypes)),Y(e.rowcount),M(""),E.add(t),a&&o&&o.setForceQuery(!1)})).catch((e=>{u([]),b([]),A([]),M(`${e.name}: ${e.message}`)})).finally((()=>{S(!1)})))}),[t,e,a]);const I=(0,w.XS)(p,f,d,$,i,{},!0),R=(0,w.$r)(s,d);if(C)return(0,x.Y)(m.A,null);if(D)return(0,x.Y)(n.Fragment,null,(0,x.Y)(y.x,{data:R,columnNames:p,columnTypes:f,rowcount:T,datasourceId:$,onInputChange:e=>c(e),isLoading:C}),(0,x.Y)(F,null,D));if(0===d.length){const e=(0,l.t)("No samples were returned for this dataset");return(0,x.Y)(g.uq,{image:"document.svg",title:e})}return(0,x.Y)(n.Fragment,null,(0,x.Y)(y.x,{data:R,columnNames:p,columnTypes:f,rowcount:T,datasourceId:$,onInputChange:e=>c(e),isLoading:C}),(0,x.Y)(_.A,{columns:I,data:R,pageSize:r,noDataText:(0,l.t)("No results"),emptyWrapperType:_.V.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,small:!0}))},M=r.A.div`
  ${({theme:e})=>`\n    position: relative;\n    background-color: ${e.colors.grayscale.light5};\n    z-index: 5;\n    overflow: hidden;\n\n    .ant-tabs {\n      height: 100%;\n    }\n\n    .ant-tabs-content-holder {\n      height: 100%;\n    }\n\n    .ant-tabs-content {\n      height: 100%;\n    }\n\n    .ant-tabs-tabpane {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n\n      .table-condensed {\n        height: 100%;\n        overflow: auto;\n        margin-bottom: ${4*e.gridUnit}px;\n\n        .table {\n          margin-bottom: ${2*e.gridUnit}px;\n        }\n      }\n\n      .pagination-container > ul[role='navigation'] {\n        margin-top: 0;\n      }\n    }\n  `}
`,$=({queryFormData:e,datasource:t,queryForce:a,onCollapseChange:r,chartStatus:p,ownState:h,errorMessage:m,actions:g})=>{const v=(0,i.DP)(),[b,f]=(0,n.useState)(o.Results),[A,C]=(0,n.useState)({results:!1,samples:!1}),[T,Y]=(0,n.useState)(!(0,s.G7)(s.TO.DatapanelClosedByDefault)&&(0,u.Gq)(u.Hh.IsDatapanelOpen,!1));(0,n.useEffect)((()=>{(0,s.G7)(s.TO.DatapanelClosedByDefault)||(0,u.SO)(u.Hh.IsDatapanelOpen,T)}),[T]),(0,n.useEffect)((()=>{T||C({results:!1,samples:!1}),T&&b.startsWith(o.Results)&&p&&"loading"!==p&&C({results:!0,samples:!1}),T&&b===o.Samples&&C({results:!1,samples:!0})}),[T,b,p]);const _=(0,n.useCallback)((e=>{r(e),Y(e)}),[r]),w=(0,n.useCallback)(((e,t)=>{T?e===b&&(t.preventDefault(),_(!1)):_(!0),f(e)}),[b,_,T]),F=(0,n.useMemo)((()=>{const e=T?(0,x.Y)(c.A.CaretUp,{iconColor:v.colors.grayscale.base,"aria-label":(0,l.t)("Collapse data panel")}):(0,x.Y)(c.A.CaretDown,{iconColor:v.colors.grayscale.base,"aria-label":(0,l.t)("Expand data panel")});return(0,x.Y)(y.y,null,T?(0,x.Y)("span",{role:"button",tabIndex:0,onClick:()=>_(!1)},e):(0,x.Y)("span",{role:"button",tabIndex:0,onClick:()=>_(!0)},e))}),[_,T,v.colors.grayscale.base]),E=S({errorMessage:m,queryFormData:e,queryForce:a,ownState:h,isRequest:A.results,actions:g,isVisible:o.Results===b}).map(((e,t)=>0===t?(0,x.Y)(d.Ay.TabPane,{tab:(0,l.t)("Results"),key:o.Results},e):t>0?(0,x.Y)(d.Ay.TabPane,{tab:(0,l.t)("Results %s",t+1),key:`${o.Results} ${t+1}`},e):null));return(0,x.Y)(M,{"data-test":"some-purposeful-instance"},(0,x.Y)(d.Ay,{fullWidth:!1,tabBarExtraContent:F,activeKey:T?b:"",onTabClick:w},E,(0,x.Y)(d.Ay.TabPane,{tab:(0,l.t)("Samples"),key:o.Samples},(0,x.Y)(D,{datasource:t,queryForce:a,isRequest:A.samples,actions:g,isVisible:o.Samples===b}))))}},28254:(e,t,a)=>{var o;a.d(t,{S:()=>o}),function(e){e.Column="column",e.ColumnOption="columnOption",e.AdhocColumnOption="adhocColumn",e.Metric="metric",e.MetricOption="metricOption",e.AdhocMetricOption="adhocMetric",e.FilterOption="filterOption"}(o||(o={}))},16238:(e,t,a)=>{a.d(t,{y:()=>o});const o=a(90017).A.div`
  .edit-popover-resize {
    transform: scaleX(-1);
    float: right;
    margin-top: ${({theme:e})=>4*e.gridUnit}px;
    margin-right: ${({theme:e})=>-2*e.gridUnit}px;
    cursor: nwse-resize;
  }
  .filter-sql-editor {
    border: ${({theme:e})=>e.colors.grayscale.light2} solid thin;
  }
`},26761:(e,t,a)=>{a.d(t,{A:()=>c}),a(96540);var o=a(95579),n=a(32142),r=a(2738),i=a(19129),s=a(17437);const l=(0,o.t)("The row limit set for the chart was reached. The chart may show partial data.");function c(e){const{rowcount:t=0,limit:a=null,loading:c}=e,d=a&&t>=a,u=d||0===t&&!c?"danger":"default",p=(0,n.gV)()(t),h=(0,s.Y)(r.A,{type:u},c?(0,o.t)("Loading..."):(0,s.Y)("span",{"data-test":"row-count-label"},(0,o.tn)("%s row","%s rows",t,p)));return d?(0,s.Y)(i.m,{id:"tt-rowcount-tooltip",title:(0,s.Y)("span",null,l)},h):h}},23133:(e,t,a)=>{a.d(t,{A:()=>K});var o=a(96540),n=a(97032),r=a(5556),i=a.n(r),s=a(46920),l=a(90017),c=a(95579),d=a(49544),u=a(48327),p=a(8901),h=a(90422),m=a(86523),g=a(15595),v=a(13270),b=a(35742),f=a(27366),y=a(95483),x=a(84064),A=a(19129),C=a(90868),S=a(15151),T=a(67984),Y=a(38221),_=a.n(Y),w=a(62952),F=a(58561),E=a.n(F);const D={parsedAdvancedDataType:"",advancedDataTypeOperatorList:[],errorMessage:""};var M=a(59638),$=a(39942),I=a(2511),R=a(17437);const k=(0,l.A)(C.pd)`
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;
`,O=((0,l.A)(m.A)`
  &.ant-row.ant-form-item {
    margin: 0;
  }
`,(0,l.A)(g.l6)`
  .ant-select-selector::after {
    content: ${({labelText:e})=>e||"\\A0"};
    display: inline-block;
    white-space: nowrap;
    color: ${({theme:e})=>e.colors.grayscale.light1};
    width: max-content;
  }
`),N=e=>{var t,a;const{onSubjectChange:r,onOperatorChange:i,isOperatorRelevant:s,onComparatorChange:l,onDatePickerChange:d}=(e=>{const t=(0,$.IM)(),a=(t,a)=>{var o;const n=null==(o=e.datasource.columns)?void 0:o.find((e=>e.column_name===a)),r=!!n&&("BOOL"===n.type||"BOOLEAN"===n.type),i=!!n&&("INT"===n.type||"INTEGER"===n.type),s=!!n&&!!n.expression;if(t&&t===y.ux.LatestPartition){const{partitionColumn:t}=e;return t&&a&&a===t}return(!t||t!==y.ux.TemporalRange)&&(t===y.ux.IsTrue||t===y.ux.IsFalse?r||i||s:r?t===y.ux.IsNull||t===y.ux.IsNotNull:e.adhocFilter.clause!==I.v.Having||-1!==y._T.indexOf(t))};return{onSubjectChange:o=>{const n=e.options.find((e=>"column_name"in e&&e.column_name===o||"optionName"in e&&e.optionName===o));let r,i="";n&&"column_name"in n?(i=n.column_name,r=I.v.Where):n&&"saved_metric_name"in n?(i=n.saved_metric_name,r=I.v.Having):null!=n&&n.label&&(i=n.label,r=I.v.Having);let{operator:s,operatorId:l,comparator:c}=e.adhocFilter;s=s&&l&&a(l,i)?y.nS[l].operation:null,(0,v.A)(s)||(s=y.ux.In,l=y.ux.In,c=void 0),(0,T.D)(o,e.datasource)&&(i=o,s=y.ux.TemporalRange,l=y.ux.TemporalRange,c=t),e.onChange(e.adhocFilter.duplicateWith({subject:i,clause:r,operator:s,expressionType:I.A.Simple,operatorId:l,comparator:c}))},onOperatorChange:t=>{const a=e.adhocFilter.comparator;let o;o=y.sJ.has(t)?Array.isArray(a)?a:[a].filter((e=>e)):Array.isArray(a)?a[0]:a,t!==y.ux.IsTrue&&t!==y.ux.IsFalse||(o=y.ux.IsTrue===t),t&&y.Wy.has(t)?e.onChange(e.adhocFilter.duplicateWith({subject:e.adhocFilter.subject,clause:I.v.Where,operatorId:t,operator:y.nS[t].operation,expressionType:I.A.Sql,datasource:e.datasource})):e.onChange(e.adhocFilter.duplicateWith({operatorId:t,operator:y.nS[t].operation,comparator:o,expressionType:I.A.Simple}))},onComparatorChange:t=>{e.onChange(e.adhocFilter.duplicateWith({comparator:t,expressionType:I.A.Simple}))},isOperatorRelevant:a,clearOperator:()=>{e.onChange(e.adhocFilter.duplicateWith({operatorId:void 0,operator:void 0}))},onDatePickerChange:(t,a)=>{e.onChange(e.adhocFilter.duplicateWith({subject:t,operator:y.ux.TemporalRange,comparator:a,expressionType:I.A.Simple}))}}})(e),[u,p]=(0,o.useState)([]),[h,m]=(0,o.useState)(e.adhocFilter.comparator),[C,Y]=(0,o.useState)(!1),{advancedDataTypesState:F,subjectAdvancedDataType:N,fetchAdvancedDataTypeValueCallback:q,fetchSubjectAdvancedDataType:U}=(e=>{const[t,a]=(0,o.useState)(D),[n,r]=(0,o.useState)(),i=(0,o.useCallback)(((t,o,n)=>{const r=(0,w.A)(t);n?_()((()=>{const t=`/api/v1/advanced_data_type/convert?q=${E().encode({type:n,values:r})}`;b.A.get({endpoint:t}).then((({json:t})=>{a({parsedAdvancedDataType:t.result.display_value,advancedDataTypeOperatorList:t.result.valid_filter_operators,errorMessage:t.result.error_message}),e(!t.result.error_message)})).catch((()=>{a({parsedAdvancedDataType:"",advancedDataTypeOperatorList:o.advancedDataTypeOperatorList,errorMessage:(0,c.t)("Failed to retrieve advanced type")}),e(!1)}))}),600)():a(D)}),[e]);return{advancedDataTypesState:t,subjectAdvancedDataType:n,setAdvancedDataTypesState:a,fetchAdvancedDataTypeValueCallback:i,fetchSubjectAdvancedDataType:e=>{const t=e.options.find((t=>"column_name"in t&&t.column_name===e.adhocFilter.subject||"optionName"in t&&t.optionName===e.adhocFilter.subject));t&&"advanced_data_type"in t?r(t.advanced_data_type):e.validHandler(!0)}}})(e.validHandler),L=(e,t)=>N?s(e,t)&&F.advancedDataTypeOperatorList.includes(e):s(e,t),j=()=>{const e=(()=>{var e;const t=Array.isArray(h)?h.filter((e=>u.includes(e))).length:0;return null!=(e=(null==u?void 0:u.length)-t)?e:0})(),t=(0,c.t)("%s option(s)",e);return e?t:""};let P=e.options;const{subject:H,operator:z,operatorId:V}=e.adhocFilter,W={ariaLabel:(0,c.t)("Select subject"),value:null!=H?H:void 0,onChange:e=>{m(void 0),r(e)},notFoundContent:(0,c.t)("No such column found. To filter on a metric, try the Custom SQL tab."),autoFocus:!H,placeholder:""};W.placeholder=e.adhocFilter.clause===I.v.Where?(0,c.t)("%s column(s)",P.length):(0,c.t)("To filter on a metric, use Custom SQL tab."),P=e.options.filter((e=>"column_name"in e&&e.column_name));const B={placeholder:(0,c.t)("%s operator(s)",(null!=(t=e.operators)?t:y.RX).filter((e=>L(e,H))).length),value:V,onChange:i,autoFocus:!!W.value&&!z,ariaLabel:(0,c.t)("Select operator")},G=!!W.value&&!!B.value,Q={allowClear:!0,allowNewOptions:!0,ariaLabel:(0,c.t)("Comparator option"),mode:y.sJ.has(V)?"multiple":"single",loading:C,value:h,onChange:l,notFoundContent:(0,c.t)("Type a value here"),disabled:y.Sd.includes(V),placeholder:j(),autoFocus:G},X=h&&h.length>0&&j(),J=(0,M.w)({columnName:e.adhocFilter.subject,timeRange:e.adhocFilter.operator===y.ux.TemporalRange?e.adhocFilter.comparator:void 0,datasource:e.datasource,onChange:d});(0,o.useEffect)((()=>{J||(()=>{const{datasource:t}=e,a=e.adhocFilter.subject,o=e.adhocFilter.clause===I.v.Having;if(a&&t&&t.filter_select&&!o){const e=new AbortController,{signal:o}=e;C&&e.abort(),Y(!0),b.A.get({signal:o,endpoint:`/api/v1/datasource/${t.type}/${t.id}/column/${a}/values/`}).then((({json:e})=>{p(e.result.map((e=>({value:e,label:(0,S.ed)(e)})))),Y(!1)})).catch((()=>{p([]),Y(!1)}))}})()}),[e.adhocFilter.subject]),(0,o.useEffect)((()=>{(0,f.G7)(f.TO.EnableAdvancedDataTypes)&&U(e)}),[e.adhocFilter.subject]),(0,o.useEffect)((()=>{(0,f.G7)(f.TO.EnableAdvancedDataTypes)&&q(void 0===h?"":h,F,N)}),[h,N,q]),(0,o.useEffect)((()=>{(0,f.G7)(f.TO.EnableAdvancedDataTypes)&&m(e.adhocFilter.comparator)}),[e.adhocFilter.comparator]);const K=(0,R.Y)(g.l6,(0,n.A)({css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),"data-test":"select-element",options:P.map((e=>{return{value:"column_name"in e&&e.column_name||"optionName"in e&&e.optionName||"",label:"saved_metric_name"in e&&e.saved_metric_name||"column_name"in e&&e.column_name||"label"in e&&e.label,key:"id"in e&&e.id||"optionName"in e&&e.optionName||void 0,customLabel:(t=e,(0,R.Y)(x.A,{option:t}))};var t}))},W)),Z=(0,R.Y)(o.Fragment,null,(0,R.Y)(g.l6,(0,n.A)({css:e=>({marginBottom:4*e.gridUnit}),options:(null!=(a=e.operators)?a:y.RX).filter((e=>L(e,H))).map(((e,t)=>({value:e,label:y.nS[e].display,key:e,order:t})))},B)),y.sJ.has(V)||u.length>0?(0,R.Y)(A.m,{title:F.errorMessage||F.parsedAdvancedDataType},(0,R.Y)(O,(0,n.A)({labelText:X,options:u},Q))):(0,R.Y)(A.m,{title:F.errorMessage||F.parsedAdvancedDataType},(0,R.Y)(k,{"data-test":"adhoc-filter-simple-value",name:"filter-value",ref:e=>{e&&G&&e.focus()},onChange:e=>{const{value:t}=e.target;m(t),l(t)},value:h,placeholder:(0,c.t)("Filter value (case sensitive)"),disabled:y.Sd.includes(V)})));return(0,R.Y)(o.Fragment,null,K,null!=J?J:Z)};var q=a(41154),U=a(28274),L=a(21062);const j={adhocFilter:i().instanceOf(h.A).isRequired,onChange:i().func.isRequired,options:i().arrayOf(i().oneOfType([L.A,i().shape({saved_metric_name:i().string.isRequired}),p.A])).isRequired,height:i().number.isRequired},P=(0,l.A)(g.l6)`
  ${({theme:e})=>`\n    width: ${30*e.gridUnit}px;\n    marginRight: ${e.gridUnit}px;\n  `}
`;class H extends o.Component{constructor(e){super(e),this.onSqlExpressionChange=this.onSqlExpressionChange.bind(this),this.onSqlExpressionClauseChange=this.onSqlExpressionClauseChange.bind(this),this.handleAceEditorRef=this.handleAceEditorRef.bind(this)}componentDidUpdate(){this.aceEditorRef&&this.aceEditorRef.editor.resize()}onSqlExpressionClauseChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({clause:e,expressionType:I.A.Sql}))}onSqlExpressionChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({sqlExpression:e,expressionType:I.A.Sql}))}handleAceEditorRef(e){e&&(this.aceEditorRef=e)}render(){const{adhocFilter:e,height:t,options:a}=this.props,o=U.A.concat(a.map((e=>e.column_name?{name:e.column_name,value:e.column_name,score:50,meta:"option"}:null)).filter(Boolean)),n=Object.values(I.v).map((e=>({label:e,value:e})));return(0,R.Y)("span",null,(0,R.Y)("div",{className:"filter-edit-clause-section"},(0,R.Y)("div",null,(0,R.Y)(P,{options:n,ariaLabel:(0,c.t)("Select column"),placeholder:(0,c.t)("choose WHERE or HAVING..."),value:e.clause,onChange:this.onSqlExpressionClauseChange})),(0,R.Y)("span",{className:"filter-edit-clause-info"},(0,R.Y)("strong",null,"WHERE")," ",(0,c.t)("Filters by columns"),(0,R.Y)("br",null),(0,R.Y)("strong",null,"HAVING")," ",(0,c.t)("Filters by metrics"))),(0,R.Y)("div",{css:e=>({marginTop:4*e.gridUnit})},(0,R.Y)(q.YU,{ref:this.handleAceEditorRef,keywords:o,height:t-130+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:e.sqlExpression||e.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0})))}}H.propTypes=j;const z={adhocFilter:i().instanceOf(h.A).isRequired,onChange:i().func.isRequired,onClose:i().func.isRequired,onResize:i().func.isRequired,options:i().arrayOf(i().oneOfType([L.A,i().shape({saved_metric_name:i().string.isRequired}),p.A])).isRequired,datasource:i().object,partitionColumn:i().string,theme:i().object,sections:i().arrayOf(i().string),operators:i().arrayOf(i().string),requireSave:i().bool},V=l.A.i`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,W=l.A.div`
  .adhoc-filter-edit-tabs > .nav-tabs {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;

    & > li > a {
      padding: ${({theme:e})=>e.gridUnit}px;
    }
  }

  #filter-edit-popover {
    max-width: none;
  }

  .filter-edit-clause-info {
    font-size: ${({theme:e})=>e.typography.sizes.xs}px;
  }

  .filter-edit-clause-section {
    display: flex;
    flex-direction: row;
    gap: ${({theme:e})=>5*e.gridUnit}px;
  }

  .adhoc-filter-simple-column-dropdown {
    margin-top: ${({theme:e})=>5*e.gridUnit}px;
  }
`,B=l.A.div`
  margin-top: ${({theme:e})=>2*e.gridUnit}px;
`;class G extends o.Component{constructor(e){var t,a;super(e),this.onSave=this.onSave.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onAdhocFilterChange=this.onAdhocFilterChange.bind(this),this.setSimpleTabIsValid=this.setSimpleTabIsValid.bind(this),this.adjustHeight=this.adjustHeight.bind(this),this.onTabChange=this.onTabChange.bind(this),this.state={adhocFilter:this.props.adhocFilter,width:y._R,height:y.Z_,activeKey:(null==(t=this.props)||null==(a=t.adhocFilter)?void 0:a.expressionType)||"SIMPLE",isSimpleTabValid:!0},this.popoverContentRef=o.createRef()}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}onAdhocFilterChange(e){this.setState({adhocFilter:e})}setSimpleTabIsValid(e){this.setState({isSimpleTabValid:e})}onSave(){this.props.onChange(this.state.adhocFilter),this.props.onClose()}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),y._R),height:Math.max(this.dragStartHeight+(e.clientY-this.dragStartY),y.Z_)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.setState({activeKey:e})}adjustHeight(e){this.setState((t=>({height:t.height+e})))}render(){const{adhocFilter:e,options:t,onChange:a,onClose:o,onResize:r,datasource:i,partitionColumn:l,theme:p,operators:h,requireSave:m,...g}=this.props,{adhocFilter:v}=this.state,b=v.isValid(),f=m||!v.equals(e);return(0,R.Y)(W,(0,n.A)({id:"filter-edit-popover"},g,{"data-test":"filter-edit-popover",ref:this.popoverContentRef}),(0,R.Y)(u.Ay,{id:"adhoc-filter-edit-tabs",defaultActiveKey:v.expressionType,className:"adhoc-filter-edit-tabs","data-test":"adhoc-filter-edit-tabs",style:{minHeight:this.state.height,width:this.state.width},allowOverflow:!0,onChange:this.onTabChange},(0,R.Y)(u.Ay.TabPane,{className:"adhoc-filter-edit-tab",key:I.A.Simple,tab:(0,c.t)("Simple")},(0,R.Y)(d.A,null,(0,R.Y)(N,{operators:h,adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:t,datasource:i,onHeightChange:this.adjustHeight,partitionColumn:l,popoverRef:this.popoverContentRef.current,validHandler:this.setSimpleTabIsValid}))),(0,R.Y)(u.Ay.TabPane,{className:"adhoc-filter-edit-tab",key:I.A.Sql,tab:(0,c.t)("Custom SQL")},(0,R.Y)(d.A,null,(0,R.Y)(H,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height,activeKey:this.state.activeKey})))),(0,R.Y)(B,null,(0,R.Y)(s.A,{buttonSize:"small",onClick:this.props.onClose,cta:!0},(0,c.t)("Close")),(0,R.Y)(s.A,{"data-test":"adhoc-filter-edit-popover-save-button",disabled:!b||!this.state.isSimpleTabValid||!f,buttonStyle:"primary",buttonSize:"small",className:"m-r-5",onClick:this.onSave,cta:!0},(0,c.t)("Save")),(0,R.Y)(V,{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})))}}G.propTypes=z;var Q=a(16238),X=a(22533);class J extends o.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.state={popoverVisible:!1}}onPopoverResize(){this.forceUpdate()}closePopover(){this.togglePopover(!1)}togglePopover(e){this.setState({popoverVisible:e})}render(){const{adhocFilter:e,isControlledComponent:t}=this.props,{visible:a,togglePopover:o,closePopover:n}=t?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},r=(0,R.Y)(Q.y,null,(0,R.Y)(G,{adhocFilter:e,options:this.props.options,datasource:this.props.datasource,partitionColumn:this.props.partitionColumn,onResize:this.onPopoverResize,onClose:n,sections:this.props.sections,operators:this.props.operators,onChange:this.props.onFilterEdit,requireSave:this.props.requireSave}));return(0,R.Y)(X.A,{trigger:"click",content:r,defaultVisible:a,visible:a,onVisibleChange:o,destroyTooltipOnHide:!0},this.props.children)}}const K=J},2511:(e,t,a)=>{var o,n;a.d(t,{A:()=>o,v:()=>n}),function(e){e.Simple="SIMPLE",e.Sql="SQL"}(o||(o={})),function(e){e.Having="HAVING",e.Where="WHERE"}(n||(n={}))},59638:(e,t,a)=>{a.d(t,{w:()=>m,K:()=>l});var o=a(96540),n=a(96627),r=a(39074),i=a(95483),s=a(2511);const l=e=>{const[t,a]=(0,o.useState)({});return(0,o.useEffect)((()=>{e.operator===i.ux.TemporalRange&&e.expressionType===s.A.Simple||a({}),e.operator===i.ux.TemporalRange&&e.comparator===n.WC&&a({actualTimeRange:`${e.subject} (${n.WC})`,title:n.WC}),e.operator===i.ux.TemporalRange&&e.expressionType===s.A.Simple&&e.comparator!==n.WC&&t.title!==e.comparator&&(0,r.x9)(e.comparator,e.subject).then((({value:t,error:o})=>{a(o?{actualTimeRange:`${e.subject} (${e.comparator})`,title:o}:{actualTimeRange:null!=t?t:"",title:e.comparator})}))}),[e]),t};var c=a(95579),d=a(67984),u=a(25755),p=a(50317),h=a(17437);const m=({columnName:e,timeRange:t,datasource:a,onChange:n})=>(0,d.D)(e,a)?(0,h.Y)(o.Fragment,null,(0,h.Y)(p.A,{label:(0,c.t)("Time Range")}),(0,h.Y)(u.A,{value:t,name:"time_range",onChange:t=>n(e,t),overlayStyle:"Modal"})):void 0},71191:(e,t,a)=>{a.d(t,{e:()=>s});var o=a(808),n=a(95483),r=a(85183);const i={"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",IN:"IN","NOT IN":"NOT IN",LIKE:"LIKE",ILIKE:"ILIKE",REGEX:"REGEX","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL","IS TRUE":"IS TRUE","IS FALSE":"IS FALSE","LATEST PARTITION":({datasource:e})=>`= '{{ presto.latest_partition('${e.schema}.${e.datasource_name}') }}'`},s=(e,{useSimple:t}={useSimple:!1})=>{if((0,o.md)(e)||t){const{subject:t,operator:a}=e,o="comparator"in e?e.comparator:void 0,s=a&&a===n.nS[n.ux.LatestPartition].operation?i[a](e):i[a];return(0,r.zJ)(t,s,o)}return(0,o.wF)(e)?e.sqlExpression:""}},72652:(e,t,a)=>{a.d(t,{B3:()=>C,Bt:()=>y,Gh:()=>x,JG:()=>_,JU:()=>b,Px:()=>F,XB:()=>w,a2:()=>v,f$:()=>Y,p6:()=>S,yJ:()=>g});var o=a(97032),n=a(96540),r=a(26206),i=a(52916),s=a(90017),l=a(17437),c=a(96453),d=a(95579),u=a(66537),p=a(19129),h=a(12249),m=a(84080);const g=s.A.div`
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
  :last-child {
    margin-bottom: 0;
  }
`,v=s.A.div`
  display: flex;
  align-items: center;
  width: 100%;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  height: ${({theme:e})=>6*e.gridUnit}px;
  background-color: ${({theme:e})=>e.colors.grayscale.light3};
  border-radius: 3px;
  cursor: ${({withCaret:e})=>e?"pointer":"default"};
`,b=s.A.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${e.gridUnit}px;\n    svg {\n      margin-right: ${e.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${2*e.gridUnit}px;\n      margin-left: ${e.gridUnit}px;\n      font-weight: ${e.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}
`,f=s.A.span`
  overflow: hidden;
  text-overflow: ellipsis;
`,y=s.A.div`
  height: 100%;
  border-left: solid 1px ${({theme:e})=>e.colors.grayscale.dark2}0C;
  margin-left: auto;
`,x=s.A.div`
  height: 100%;
  width: ${({theme:e})=>6*e.gridUnit}px;
  border-right: solid 1px ${({theme:e})=>e.colors.grayscale.dark2}0C;
  cursor: pointer;
`,A=(0,s.A)(u.W)`
  margin: 0 ${({theme:e})=>e.gridUnit}px;
`,C=s.A.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`,S=s.A.div`
  padding: ${({theme:e})=>e.gridUnit}px;
  border: solid 1px ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: ${({theme:e})=>e.gridUnit}px;
`,T=l.i7`
  0% {
    right: 100%;
  }
  50% {
    left: 4px;
  }
  90% {
    right: 4px;
  }
  100% {
    left: 100%;
  }
`,Y=s.A.div`
  ${({theme:e,isLoading:t,canDrop:a,isDragging:o,isOver:n})=>`\n  position: relative;\n  padding: ${e.gridUnit}px;\n  border: ${!t&&o?`dashed 1px ${a?e.colors.info.dark1:e.colors.error.dark1}`:`solid 1px ${t&&o?e.colors.warning.light1:e.colors.grayscale.light2}`};\n  border-radius: ${e.gridUnit}px;\n  &:before,\n  &:after {\n    content: ' ';\n    position: absolute;\n    border-radius: ${e.gridUnit}px;\n  }\n  &:before {\n    display: ${o||t?"block":"none"};\n    background-color: ${a?e.colors.primary.base:e.colors.error.light1};\n    z-index: ${e.zIndex.aboveDashboardCharts};\n    opacity: ${e.opacity.light};\n    top: 1px;\n    right: 1px;\n    bottom: 1px;\n    left: 1px;\n  }\n  &:after {\n    display: ${t||a&&n?"block":"none"};\n    background-color: ${t?e.colors.grayscale.light3:e.colors.primary.base};\n    z-index: ${e.zIndex.dropdown};\n    opacity: ${e.opacity.mediumLight};\n    top: ${-e.gridUnit}px;\n    right: ${-e.gridUnit}px;\n    bottom: ${-e.gridUnit}px;\n    left: ${-e.gridUnit}px;\n    cursor: ${t?"wait":"auto"};\n  }\n  `}

  &:before {
    ${({theme:e,isLoading:t})=>t&&l.AH`
        animation: ${T} 2s ease-in infinite;
        background: linear-gradient(currentColor 0 0) 0 100%/0% 3px no-repeat;
        background-size: 100% ${e.gridUnit/2}px;
        top: auto;
        right: ${e.gridUnit}px;
        left: ${e.gridUnit}px;
        bottom: -${e.gridUnit/2}px;
        height: ${e.gridUnit/2}px;
      `};
  }
`,_=s.A.div`
  display: flex;
  align-items: center;
  width: 100%;
  height: ${({theme:e})=>6*e.gridUnit}px;
  padding-left: ${({theme:e})=>e.gridUnit}px;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.light1};
  border: dashed 1px ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: ${({theme:e})=>e.gridUnit}px;
  cursor: ${({cancelHover:e})=>e?"inherit":"pointer"};

  :hover {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light4};
  }

  :active {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light3};
  }
`,w=s.A.button`
  display: flex;
  align-items: center;
  justify-content: center;
  height: ${({theme:e})=>4*e.gridUnit}px;
  width: ${({theme:e})=>4*e.gridUnit}px;
  padding: 0;
  background-color: ${({theme:e})=>e.colors.primary.dark1};
  border: none;
  border-radius: 2px;

  :disabled {
    cursor: not-allowed;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,F=({label:e,savedMetric:t,adhocMetric:a,onRemove:s,onMoveLabel:u,onDropLabel:C,withCaret:S,isFunction:T,type:Y,index:_,isExtra:w,datasourceWarningMessage:F,tooltipTitle:E,multi:D=!0,...M})=>{const $=(0,c.DP)(),I=(0,n.useRef)(null),R=(0,n.useRef)(null),k=null==t?void 0:t.metric_name,[,O]=(0,r.H)({accept:Y,drop(){D&&(null==C||C())},hover(e,t){var a;if(!D)return;if(!I.current)return;const{dragIndex:o}=e,n=_;if(o===n)return;const r=null==(a=I.current)?void 0:a.getBoundingClientRect(),i=(r.bottom-r.top)/2,s=t.getClientOffset(),l=null!=s&&s.y?(null==s?void 0:s.y)-r.top:0;o<n&&l<i||o>n&&l>i||(null==u||u(o,n),e.dragIndex=n)}}),[{isDragging:N},q]=(0,i.i)({item:{type:Y,dragIndex:_,value:null!=t&&t.metric_name?t:a},collect:e=>({isDragging:e.isDragging()})});return q(O(I)),(0,l.Y)(g,{ref:I},(0,l.Y)(v,(0,o.A)({withCaret:S,"data-test":"option-label"},M),(0,l.Y)(x,{role:"button","data-test":"remove-control-button",onClick:s},(0,l.Y)(h.A.XSmall,{iconColor:$.colors.grayscale.light1})),(0,l.Y)(b,{"data-test":"control-label"},T&&(0,l.Y)(h.A.FieldDerived,null),(()=>{const a=!N&&"string"==typeof e&&E&&e&&E!==e||!N&&R&&R.current&&R.current.scrollWidth>R.current.clientWidth;return t&&k?(0,l.Y)(m.b,{metric:t,labelRef:R,shouldShowTooltip:!N}):a?(0,l.Y)(p.m,{title:E||e},(0,l.Y)(f,{ref:R},e)):(0,l.Y)(f,{ref:R},e)})()),(!!F||w)&&(0,l.Y)(A,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:F||(0,d.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),S&&(0,l.Y)(y,null,(0,l.Y)(h.A.CaretRight,{iconColor:$.colors.grayscale.light1}))))}},91643:(e,t,a)=>{a.d(t,{A:()=>v}),a(96540);var o=a(90017),n=a(45738),r=a(10286),i=a(55594),s=a(39091),l=a(8143),c=a(69633),d=a(78360),u=a(69172),p=a(17437);const h=(0,o.A)(s.i8)`
  && {
    margin: 0 0 ${({theme:e})=>e.gridUnit}px;
  }
`;n.A.registerLanguage("markdown",l.A),n.A.registerLanguage("html",c.A),n.A.registerLanguage("sql",d.A),n.A.registerLanguage("json",u.A);const m=o.A.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,g=(0,o.A)(n.A)`
  flex: 1;
`,v=e=>{const{sql:t,language:a="sql"}=e;return(0,p.Y)(m,{key:t},(0,p.Y)(i.A,{text:t,shouldShowText:!1,copyNode:(0,p.Y)(h,{buttonSize:"xsmall"},(0,p.Y)("i",{className:"fa fa-clipboard"}))}),(0,p.Y)(g,{language:a,style:r.A},t))}},17432:(e,t,a)=>{a.d(t,{A:()=>h});var o=a(96540),n=a(90017),r=a(62952),i=a(95579),s=a(17444),l=a(94146),c=a(2514),d=a(91643),u=a(17437);const p=n.A.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,h=e=>{const[t,a]=(0,o.useState)([]),[n,h]=(0,o.useState)(!1),[m,g]=(0,o.useState)(null);return(0,o.useEffect)((()=>{h(!0),(0,c.getChartDataRequest)({formData:e.latestQueryFormData,resultFormat:"json",resultType:"query"}).then((({json:e})=>{a((0,r.A)(e.result)),h(!1),g(null)})).catch((e=>{(0,l.h4)(e).then((({error:t,message:a})=>{g(t||a||e.statusText||(0,i.t)("Sorry, An error occurred")),h(!1)}))}))}),[JSON.stringify(e.latestQueryFormData)]),n?(0,u.Y)(s.A,null):m?(0,u.Y)("pre",null,m):(0,u.Y)(p,null,t.map((e=>e.query?(0,u.Y)(d.A,{sql:e.query,language:e.language||void 0}):null)))}},60237:(e,t,a)=>{a.d(t,{T3:()=>d,cL:()=>u,kV:()=>s});var o=a(90179),n=a.n(o),r=a(35742);const i=["url_params"],s=e=>n()(e,i),l=(e,t)=>{let a="api/v1/explore/form_data";return e&&(a=a.concat(`/${e}`)),t&&(a=a.concat(`?tab_id=${t}`)),a},c=(e,t,a,o)=>{const n={datasource_id:e,datasource_type:t,form_data:JSON.stringify(s(a))};return o&&(n.chart_id=o),n},d=(e,t,a,o,n)=>r.A.post({endpoint:l(void 0,n),jsonPayload:c(e,t,a,o)}).then((e=>e.json.key)),u=(e,t,a,o,n,i)=>r.A.put({endpoint:l(a,i),jsonPayload:c(e,t,o,n)}).then((e=>e.json.message))},55976:(e,t,a)=>{a.d(t,{M:()=>p});var o=a(96540),n=a(96453),r=a(95579),i=a(17437),s=a(25946),l=a(13917),c=a(70175),d=a(86274),u=a(35233);const p=({dataset:e,datasetId:t})=>{const a=(0,n.DP)(),[p,h]=(0,o.useState)(),[m,g]=(0,o.useState)(e?d.bk.Complete:d.bk.Loading);return(0,o.useEffect)((()=>{!e&&t&&(0,u.w)({endpoint:`/api/v1/dataset/${t}`}).then((({json:{result:e}})=>{h(e),g(d.bk.Complete)})).catch((()=>{g(d.bk.Error)}))}),[t,e]),{metadataBar:(0,o.useMemo)((()=>{const t=[],o=e||p;if(o){var n,u;const{changed_on_humanized:e,created_on_humanized:a,description:i,table_name:s,changed_by:l,created_by:d,owners:p}=o,h=(0,r.t)("Not available"),m=`${null!=(n=null==d?void 0:d.first_name)?n:""} ${null!=(u=null==d?void 0:d.last_name)?u:""}`.trim()||h,g=l?`${l.first_name} ${l.last_name}`:h,v=(null==p?void 0:p.length)>0?p.map((e=>`${e.first_name} ${e.last_name}`)):[h];t.push({type:c.Q.Table,title:s}),t.push({type:c.Q.LastModified,value:e,modifiedBy:g}),t.push({type:c.Q.Owner,createdBy:m,owners:v,createdOn:a}),i&&t.push({type:c.Q.Description,value:i})}return(0,i.Y)("div",{css:i.AH`
          display: flex;
          margin-bottom: ${4*a.gridUnit}px;
        `},m===d.bk.Complete&&(0,i.Y)(l.Ay,{items:t,tooltipPlacement:"bottom"}),m===d.bk.Error&&(0,i.Y)(s.A,{type:"error",message:(0,r.t)("There was an error loading the dataset metadata")}))}),[e,p,m,a.gridUnit]),status:m}}},48422:(e,t,a)=>{a.d(t,{w:()=>s});var o=a(96540),n=a(65824),r=a.n(n);const i=new(a(98831).X2)("tab_id_channel");function s(){const[e,t]=(0,o.useState)();return(0,o.useEffect)((()=>{if(!function(){try{return window.localStorage&&window.sessionStorage}catch(e){return!1}}())return void(e||t(r().generate()));const a=()=>{let e;try{e=window.localStorage.getItem("last_tab_id")}catch(e){}const a=String(e?Number.parseInt(e,10)+1:1);try{window.sessionStorage.setItem("tab_id",a),window.localStorage.setItem("last_tab_id",a)}catch(e){}t(a)};let o;try{o=window.sessionStorage.getItem("tab_id")}catch(e){}o?(i.postMessage({type:"REQUESTING_TAB_ID",tabId:o}),t(o)):a(),i.onmessage=t=>{if(t.tabId===e)if("REQUESTING_TAB_ID"===t.type){const e={type:"TAB_ID_DENIED",tabId:t.tabId};i.postMessage(e)}else"TAB_ID_DENIED"===t.type&&a()}}),[e]),e}},35233:(e,t,a)=>{a.d(t,{e:()=>r,w:()=>i});var o=a(35742),n=a(43859);const r=new Map,i=(0,n.K)(o.A.get,r,(({endpoint:e})=>e||""))},72965:(e,t,a)=>{a.d(t,{A:()=>u});var o=a(20249),n=a.n(o),r=a(67390),i=a.n(r),s=a(95579),l=a(96453),c=a(95272);const d=(e,t=new Date)=>`${n()(e)}-${t.toISOString().replace(/[: ]/g,"-")}`;function u(e,t,a=!1){return o=>{const n=a?document.querySelector(e):o.currentTarget.closest(e);return n?i().toJpeg(n,{bgcolor:l.TT.colors.grayscale.light4,filter:e=>"string"!=typeof e.className||"mapboxgl-control-container"!==e.className&&!e.className.includes("header-controls")}).then((e=>{const a=document.createElement("a");a.download=`${d(t)}.jpg`,a.href=e,a.click()})).catch((e=>{console.error("Creating image failed",e)})):(0,c.Zd)((0,s.t)("Image download failed, please refresh and try again."))}}},21357:(e,t,a)=>{a.d(t,{w:()=>i});var o=a(95579);const n=(0,o.t)("Create chart"),r=(0,o.t)("Update chart"),i=e=>(0,o.t)("Select values in highlighted field(s) in the control panel. Then run the query by clicking on the %s button.",`"${e?n:r}"`)},59838:(e,t,a)=>{a.d(t,{r:()=>s});var o=a(70700),n=a(2511),r=a(95483),i=a(71191);const s=(e,t=n.v.Where)=>{let a;var s;return a=(0,o.q0)(e.col)?{expressionType:"SQL",clause:t,sqlExpression:(0,i.e)({expressionType:n.A.Simple,subject:`(${e.col.sqlExpression})`,operator:e.op,comparator:"val"in e?e.val:void 0})}:{expressionType:"SIMPLE",clause:t,operator:e.op,operatorId:null==(s=Object.entries(r.nS).find((t=>t[1].operation===e.op)))?void 0:s[0],subject:e.col,comparator:"val"in e?e.val:void 0},e.isExtra&&Object.assign(a,{isExtra:!0,filterOptionName:`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}),a}}}]);
//# sourceMappingURL=806093983d10e93bb971.chunk.js.map